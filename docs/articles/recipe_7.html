<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>7. Tidying data: regular expressions and reshaping datasets • Text as Data Resources</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<script src="../extra.js"></script><meta property="og:title" content="7. Tidying data: regular expressions and reshaping datasets">
<meta property="og:description" content="tadr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=294282281"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', '294282281');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">Text as Data Resources</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../tutorials/index.html">Tutorials</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="https://github.com/lin380/tadr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="recipe_7_files/header-attrs-2.11/header-attrs.js"></script><script src="recipe_7_files/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1">
<link href="recipe_7_files/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet">
<script src="recipe_7_files/bootstrap-3.3.5/js/bootstrap.min.js"></script><script src="recipe_7_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script><script src="recipe_7_files/bootstrap-3.3.5/shim/respond.min.js"></script><style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="recipe_7_files/navigation-1.1/tabsets.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>7. Tidying data: regular expressions and reshaping datasets</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/lin380/tadr/blob/master/vignettes/recipe_7.Rmd"><code>vignettes/recipe_7.Rmd</code></a></small>
      <div class="hidden name"><code>recipe_7.Rmd</code></div>

    </div>

    
    
<!-- Outline:


NOTE:

- Addin: https://github.com/gadenbuie/regexplain for building/ understanding regular expressions

-->
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>In this Recipe, we will will take a closer look at a couple coding strategies that are quite applicable for just about any stage of a text analysis project, but that make particular sense for curating data. We will look at how regular expressions are helpful in developing strategies for matching, extracting, and/ or replacing patterns in character sequences and how to change the dimensions of a dataset to either expand or collapse columns or rows.</p>
<p>As a practical case we will look at curating data from TV subtitles. We will use both regular expressions and strategies to reshape datasets. To get started let’s load the main packages we will work with in this recipe.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>  <span class="co"># data manipulation</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/quanteda/readtext">readtext</a></span><span class="op">)</span>  <span class="co"># read files</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/juliasilge/tidytext">tidytext</a></span><span class="op">)</span>  <span class="co"># text segmentation</span></code></pre></div>
</div>
<div id="coding-strategies" class="section level2">
<h2 class="hasAnchor">
<a href="#coding-strategies" class="anchor"></a>Coding strategies</h2>
<div id="regular-expressions" class="section level3">
<h3 class="hasAnchor">
<a href="#regular-expressions" class="anchor"></a>Regular expressions</h3>
<p>It is often the case that when we are working with text that we will want to find, extract, and/ or replace characters or character sequences (strings) in our data or datasets. If the string patterns are extremely simple, we may only need to use ‘literal’ strings (the exact term you are searching for), such are used in typical searches you may perform on a word processing document, for example, that help you find all the occurrences of a string. In other cases, however, the string patterns are not so literal. That is to say that we may want to find some sort of meta-character string pattern such as any single digit, sequence of digits, words that begin with capital letters, the last words of a line, etc. In this case we cannot simple type a literal character sequence and match these patterns. However if there <em>is</em> a regular pattern and the string search syntax known as <a href="https://en.wikipedia.org/wiki/Regular_expression">regular expressions</a> can help!</p>
<p>Take for example the following text:</p>
<pre class="plain"><code>1
00:00:11,160 --&gt; 00:00:13,920
- [man] What do you think love is?
- It'll be like a fairy tale.

2
00:00:14,000 --&gt; 00:00:15,560
A natural high, I suppose?

3
00:00:15,640 --&gt; 00:00:17,160
Gets your heart racing.</code></pre>
<p>This is small fragment of the contents from a subtitle file with <a href="https://docs.fileformat.com/video/srt/">SRT (SubRip File Format)</a> formatting. As we are most likely interested in extracting the language from these sequences and removing the other formatting sequences, the question is how do we do this? Regular expressions!</p>
<p>A regular expression (or regex) is the use of various general pattern matching conventions to capture abstract, but regular patterns in strings. Below are some of the most common types of regex operators, grouped in terms of their function.</p>
<p>Classes</p>
<ul>
<li>
<code>\w</code> any letter or digit character</li>
<li>
<code>\d</code> any digit character</li>
<li>
<code>\s</code> any whitespace character</li>
<li>
<code>.</code> any single character</li>
</ul>
<p>Quantifiers</p>
<ul>
<li>
<code>x?</code> zero or one of <code>x</code>
</li>
<li>
<code>x*</code> zero or more of <code>x</code>
</li>
<li>
<code>x+</code> one or more of <code>x</code>
</li>
<li>
<code>x{2,}</code> two or more of <code>x</code>
</li>
<li>
<code>x{5,10}</code> five to ten of <code>x</code>
</li>
</ul>
<p>Anchors</p>
<ul>
<li>
<code>^</code> start of string</li>
<li>
<code>$</code> end of string</li>
<li>
<code>\b</code> word boundary</li>
<li>
<code>\n</code> new line</li>
</ul>
<p>Escape</p>
<ul>
<li>
<code>\</code> make any character class, quantifier, anchor, etc. literal</li>
</ul>
<p>In this case, we want to “clean” the text by separating the non-linguistic information from the linguistic information. In the process of cleaning we may match a pattern to extract (or keep) or match to remove or replace. Looking at the text here, it looks like a good first step may be to match to remove. Specifically, let’s see if we can match the lines that start with digits.</p>
<p>Building a working regular expression requires some trial and error. To speed up the process, I tend to use an interactive regex website, <a href="https://regex101.com/">regex101</a>. I’ve opened this website and pasted the example text into the ‘TEST STRING’ field.</p>
<p>Now let’s work on building a regex for this example. Let’s try adding the <code>^</code> operator to match the beginning of the lines.</p>
<p><img src="images/recipe_7/1_regex.png" width="85%" style="display: block; margin: auto;"></p>
<p>Nothing matched, but the regex101 site shows us with the pink vertical line that that’s were the pattern matching is to begin.</p>
<p>Now let’s add <code>\d</code> the digit operator.</p>
<p><img src="images/recipe_7/2_regex.png" width="85%" style="display: block; margin: auto;"></p>
<p>We now see that the lines where there the first character is a digit are active and the first digit itself is highlighted. So far so good.</p>
<p>Comparing our active lines, we see that three of the six only have one digit and then end in a new line (<code>⏎</code>). If we add the <code>\n</code> operator to match a new line we get the following.</p>
<p><img src="images/recipe_7/3_regex.png" width="85%" style="display: block; margin: auto;"></p>
<p>You can see that we lost the longer lines which contain various other characters before the end of the line. So we want to be able to capture the lines that start with digits that either have more characters before the end of the line the first digits and those without more characters. We can turn to the <code>.*</code> operator combination which will match any character (<code>.</code>) zero more more times (<code>*</code>). Inserting this between our existing expression provides the desired match.</p>
<p><img src="images/recipe_7/4_regex.png" width="85%" style="display: block; margin: auto;"></p>
<p>So now we have a decent regex (<code>^\d.*\n</code>) that will match the lines we would like to remove from our example text. First let me read in the example text into a character vector where each line is an element in the vector.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">example_text</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://readr.tidyverse.org/reference/read_lines.html">read_lines</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"recipe_7/data/original/love_on_the_spectrum/Love.On.The.Spectrum.S01E01.WEBRip.x264-ION10.srt"</span>, <span class="co"># path to the .srt file</span>
             n_max <span class="op">=</span> <span class="fl">12</span><span class="op">)</span> <span class="co"># read only the first 12 lines</span>

<span class="va">example_text</span> <span class="co"># view character vector</span></code></pre></div>
<pre><code>##  [1] "1"                                  "00:00:11,160 --&gt; 00:00:13,920"     
##  [3] "- [man] What do you think love is?" "- It'll be like a fairy tale."     
##  [5] ""                                   "2"                                 
##  [7] "00:00:14,000 --&gt; 00:00:15,560"      "A natural high, I suppose?"        
##  [9] ""                                   "3"                                 
## [11] "00:00:15,640 --&gt; 00:00:17,160"      "Gets your heart racing."</code></pre>
<p><code>example_text</code> is the same text as above, but now each line from the file has been coverted into a separate vector. We can concatenate the vectors with a new line operator (<code>\n</code>) to show the text as it appears above.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">example_text</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># character vector</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span>sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span> <span class="co"># concatenate the vectors adding a new line (\n) between each</span></code></pre></div>
<pre><code>## 1
## 00:00:11,160 --&gt; 00:00:13,920
## - [man] What do you think love is?
## - It'll be like a fairy tale.
## 
## 2
## 00:00:14,000 --&gt; 00:00:15,560
## A natural high, I suppose?
## 
## 3
## 00:00:15,640 --&gt; 00:00:17,160
## Gets your heart racing.</code></pre>
<p>Now let’s put our regular expression to work. To do this we turn to the stringr package. Specifically the function <code><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove()</a></code> which has two arguments <code>string</code> and <code>pattern</code>. The string will be the <code>example_text</code> character vector and the pattern will be our regular expression (<code>^\d.*\n</code>) –with two twists. First, our <code>example_text</code> is broken into separate vectors by lines, so there are no more new line anchors (<code>\n</code>). Second, in R any <code>\</code> characters in regexes need to be escaped, that is they need an appended <code>\</code>. So our regex becomes <code>^\\d.*</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">example_text</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># character vector</span>
  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"^\\d.*"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove non-linguistic lines with regex</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span>sep <span class="op">=</span> <span class="st">"\n"</span><span class="op">)</span> <span class="co"># concatenate vectors</span></code></pre></div>
<pre><code>## 
## 
## - [man] What do you think love is?
## - It'll be like a fairy tale.
## 
## 
## 
## A natural high, I suppose?
## 
## 
## 
## Gets your heart racing.</code></pre>
<p>That works! Now there may be more to clean up, but this example should highlight the practicality of using regular expressions in text processing. Regular expressions are used in many ways across programming languages, including R, as well as in many desktop and web applications –so keep your eyes open for opportunities to use regexes!</p>
</div>
<div id="reshaping-data" class="section level3">
<h3 class="hasAnchor">
<a href="#reshaping-data" class="anchor"></a>Reshaping data</h3>
<p>Another key skill in which to acquire some proficiency is reshaping data. Reshaping here refers to changing the dimensions of a dataset –column-wise and/ or row-wise –to better fit the goals of the researcher.</p>
<div id="columns" class="section level4">
<h4 class="hasAnchor">
<a href="#columns" class="anchor"></a>Columns</h4>
<p>Let’s look at column-wise operations first. Consider the following single column data frame below.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">example_df</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span>
    <span class="op">~</span><span class="va">doc_id</span>,
    <span class="st">"Love.On.The.Spectrum.S01E01"</span>,
    <span class="st">"Love.On.The.Spectrum.S01E02"</span>,
    <span class="st">"Love.On.The.Spectrum.S01E03"</span>
  <span class="op">)</span>

<span class="va">example_df</span> <span class="co"># show data frame</span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">doc_id</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Love.On.The.Spectrum.S01E01</td>
</tr>
<tr class="even">
<td align="left">Love.On.The.Spectrum.S01E02</td>
</tr>
<tr class="odd">
<td align="left">Love.On.The.Spectrum.S01E03</td>
</tr>
</tbody>
</table>
</div>
<p>In this example we have a data frame with a column <code>doc_id</code> with three observations. The observations for <code>doc_id</code> happen to contain various pieces of information that we would like to have in separate columns namely the title of a TV series, the season number, and the episode number. Let’s shoot to get our dataset in the following column structure.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span>
  <span class="op">~</span><span class="va">series</span>, <span class="op">~</span><span class="va">season</span>, <span class="op">~</span><span class="va">episode</span>,
  <span class="st">"Love On The Spectrum"</span>, <span class="st">"01"</span>, <span class="st">"01"</span>,
  <span class="st">"Love On The Spectrum"</span>, <span class="st">"01"</span>, <span class="st">"02"</span>,
  <span class="st">"Love On The Spectrum"</span>, <span class="st">"01"</span>, <span class="st">"03"</span>
<span class="op">)</span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">series</th>
<th align="left">season</th>
<th align="left">episode</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
</tr>
</tbody>
</table>
</div>
<p>To separate columns we use the <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> function from the tidyr package. It takes four main arguments, the dataset <code>data</code>, the column to separate <code>col</code>, the new column names to separate the columns into <code>into</code>, and the pattern to use to separate the values of the columns <code>sep</code>. In the single column table above we see that there is a period <code>.</code> that separates each word in the series title, but it also separates the title from the season and episode group.</p>
<p>Let’s apply <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> to create five new columns that correspond to the number of columns that will result on breaking the values by <code>.</code>. Since we need the period and not the ‘any character’ operator (<code>.</code>) from regular expressions, we need to escape the period <code>\\.</code> (Remember that in R all backslashes in regular expressions are escaped –therefore we have <code>\\.</code> and not <code>\.</code>).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">example_df</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># example dataset</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">doc_id</span>, <span class="co"># column to separate</span>
           into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"column_1"</span>, <span class="st">"column_2"</span>, <span class="st">"column_3"</span>, <span class="st">"column_4"</span>, <span class="st">"column_5"</span><span class="op">)</span>, <span class="co"># new column names</span>
           sep <span class="op">=</span> <span class="st">"\\."</span><span class="op">)</span> <span class="co"># expression to separate the columns</span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">column_1</th>
<th align="left">column_2</th>
<th align="left">column_3</th>
<th align="left">column_4</th>
<th align="left">column_5</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Love</td>
<td align="left">On</td>
<td align="left">The</td>
<td align="left">Spectrum</td>
<td align="left">S01E01</td>
</tr>
<tr class="even">
<td align="left">Love</td>
<td align="left">On</td>
<td align="left">The</td>
<td align="left">Spectrum</td>
<td align="left">S01E02</td>
</tr>
<tr class="odd">
<td align="left">Love</td>
<td align="left">On</td>
<td align="left">The</td>
<td align="left">Spectrum</td>
<td align="left">S01E03</td>
</tr>
</tbody>
</table>
</div>
<p>We now have five columns, named generically for the moment. <code>column_5</code> contains the season and episode. But in this case there is not a clear character to use to break the column into two. But on closer inspection we can see that we can use the letter ‘E’ (for ‘episode’) to separate these values. It will mean that the ‘E’ will be eliminated, but that’s OK because the column title will be sufficiently informative.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">example_df</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># example dataset</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">doc_id</span>, <span class="co"># column to separate</span>
           into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"column_1"</span>, <span class="st">"column_2"</span>, <span class="st">"column_3"</span>, <span class="st">"column_4"</span>, <span class="st">"column_5"</span><span class="op">)</span>, <span class="co"># new column names</span>
           sep <span class="op">=</span> <span class="st">"\\."</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>  <span class="co"># expression to separate the columns</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">column_5</span>, <span class="co"># column to separate</span>
           into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"season"</span>, <span class="st">"episode"</span><span class="op">)</span>,  <span class="co"># new column names</span>
           sep <span class="op">=</span> <span class="st">"E"</span><span class="op">)</span> <span class="co"># expression to separate the columns</span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">column_1</th>
<th align="left">column_2</th>
<th align="left">column_3</th>
<th align="left">column_4</th>
<th align="left">season</th>
<th align="left">episode</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Love</td>
<td align="left">On</td>
<td align="left">The</td>
<td align="left">Spectrum</td>
<td align="left">S01</td>
<td align="left">01</td>
</tr>
<tr class="even">
<td align="left">Love</td>
<td align="left">On</td>
<td align="left">The</td>
<td align="left">Spectrum</td>
<td align="left">S01</td>
<td align="left">02</td>
</tr>
<tr class="odd">
<td align="left">Love</td>
<td align="left">On</td>
<td align="left">The</td>
<td align="left">Spectrum</td>
<td align="left">S01</td>
<td align="left">03</td>
</tr>
</tbody>
</table>
</div>
<p>Now the opposite of <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> is <code><a href="https://tidyr.tidyverse.org/reference/unite.html">unite()</a></code>. So this function will gather a set of columns and their values together. Let’s unite the first four columns and call it <code>series</code> adding whitespace between each value (<code>sep = " "</code>).</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">example_df</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># example dataset</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">doc_id</span>, <span class="co"># column to separate</span>
           into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"column_1"</span>, <span class="st">"column_2"</span>, <span class="st">"column_3"</span>, <span class="st">"column_4"</span>, <span class="st">"column_5"</span><span class="op">)</span>, <span class="co"># new column names</span>
           sep <span class="op">=</span> <span class="st">"\\."</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>  <span class="co"># expression to separate the columns</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">column_5</span>, <span class="co"># column to separate</span>
           into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"season"</span>, <span class="st">"episode"</span><span class="op">)</span>,  <span class="co"># new column names</span>
           sep <span class="op">=</span> <span class="st">"E"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>  <span class="co"># expression to separate the columns</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html">unite</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"series"</span>, <span class="co"># new column name</span>
        <span class="va">column_1</span><span class="op">:</span><span class="va">column_4</span>, <span class="co"># columns to unite (using the between operator `:`)</span>
        sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span> <span class="co"># separator to use to join the values of the columns</span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">series</th>
<th align="left">season</th>
<th align="left">episode</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">S01</td>
<td align="left">01</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">S01</td>
<td align="left">02</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">S01</td>
<td align="left">03</td>
</tr>
</tbody>
</table>
</div>
<p>Just for completeness, let’s use our newly acquired knowledge about regular expressions and remove the ‘S’ in the values of the <code>season</code> column.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">example_df</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># example dataset</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">doc_id</span>, <span class="co"># column to separate</span>
           into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"column_1"</span>, <span class="st">"column_2"</span>, <span class="st">"column_3"</span>, <span class="st">"column_4"</span>, <span class="st">"column_5"</span><span class="op">)</span>, <span class="co"># new column names</span>
           sep <span class="op">=</span> <span class="st">"\\."</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>  <span class="co"># expression to separate the columns</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">column_5</span>, <span class="co"># column to separate</span>
           into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"season"</span>, <span class="st">"episode"</span><span class="op">)</span>,  <span class="co"># new column names</span>
           sep <span class="op">=</span> <span class="st">"E"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>  <span class="co"># expression to separate the columns</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html">unite</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"series"</span>, <span class="co"># new column name</span>
        <span class="va">column_1</span><span class="op">:</span><span class="va">column_4</span>, <span class="co"># columns to unite (using the between operator `:`)</span>
        sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>  <span class="co"># separator to use to join the values of the columns</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>season <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">season</span>, pattern <span class="op">=</span> <span class="st">"^S"</span><span class="op">)</span><span class="op">)</span> <span class="co"># remove the S from the values of season</span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">series</th>
<th align="left">season</th>
<th align="left">episode</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="rows" class="section level4">
<h4 class="hasAnchor">
<a href="#rows" class="anchor"></a>Rows</h4>
<p>As you can imagine, there are occasions when we might want to change the the dimensions of a dataset by rows. Much in the same fashion as you saw in the previous section when we worked with expanding and collapsing columns, we can expand and collapse rows. This is a typical task to perform in text analysis on the linguistic units within a column and across rows at some linguistic level.</p>
<p>Let’s create an example data frame to work with to demonstrate various R programming strategies for expanding and collapsing rows with textual data.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">example_df</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tribble.html">tribble</a></span><span class="op">(</span>
    <span class="op">~</span><span class="va">student_id</span>, <span class="op">~</span><span class="va">class_id</span>, <span class="op">~</span><span class="va">comments</span>,
    <span class="st">"421"</span>, <span class="st">"A"</span>, <span class="st">"This class was fun! I would like to continue to work with my final essay and potentially turn in into an honors thesis. I will contact my professor to find out if this is possibility. Thanks!"</span>,
    <span class="st">"238"</span>, <span class="st">"B"</span>, <span class="st">"What shoud I say? I thought I was going to like the class but we did not get to do a final essay. I was hoping to develop a topic in this class that would help me work towards applying for an honors thesis."</span>
  <span class="op">)</span>

<span class="va">example_df</span></code></pre></div>
<div class="kable-table">
<table class="table">
<colgroup>
<col width="4%">
<col width="3%">
<col width="91%">
</colgroup>
<thead><tr class="header">
<th align="left">student_id</th>
<th align="left">class_id</th>
<th align="left">comments</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">421</td>
<td align="left">A</td>
<td align="left">This class was fun! I would like to continue to work with my final essay and potentially turn in into an honors thesis. I will contact my professor to find out if this is possibility. Thanks!</td>
</tr>
<tr class="even">
<td align="left">238</td>
<td align="left">B</td>
<td align="left">What shoud I say? I thought I was going to like the class but we did not get to do a final essay. I was hoping to develop a topic in this class that would help me work towards applying for an honors thesis.</td>
</tr>
</tbody>
</table>
</div>
<p><code>example_df</code> has three columns. Two columns correspond to metadata and the third is text. The text includes a few sentences. So the observations, as they stand, correspond to each student’s comments for a given class. If we would like to have our observations correspond to a smaller linguistic unit, say sentences, words, etc. we will want to expand the rows for each of the desired linguistic unit –while still maintaining the appropriate metadata information.</p>
<p>An indispensable package for working with text in data frames is the tidytext package. The workhorse of the tidytext package is the <code><a href="https://rdrr.io/pkg/tidytext/man/unnest_tokens.html">unnest_tokens()</a></code> function. This function allows us to separate rows in a column with text into rows corresponding to some smaller linguistic unit or ‘token’ while maintaining the tidy format of the overall dataset.</p>
<p>Included with the <code><a href="https://rdrr.io/pkg/tidytext/man/unnest_tokens.html">unnest_tokens()</a></code> function is the option to create a number of common token types (characters, words, ngrams, sentences, etc.) or one can specify the criterion manually using regular expressions.</p>
<p>So let’s apply <code><a href="https://rdrr.io/pkg/tidytext/man/unnest_tokens.html">unnest_tokens()</a></code> to the <code>example_df</code> data frame. First let’s look at breaking the <code>comments</code> column into sentences.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">example_df</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/unnest_tokens.html">unnest_tokens</a></span><span class="op">(</span>output <span class="op">=</span> <span class="st">"comment_sentences"</span>, <span class="co"># new column name</span>
                input <span class="op">=</span> <span class="st">"comments"</span>, <span class="co"># input column</span>
                token <span class="op">=</span> <span class="st">"sentences"</span><span class="op">)</span> <span class="co"># token type to create</span></code></pre></div>
<div class="kable-table">
<table class="table">
<colgroup>
<col width="8%">
<col width="6%">
<col width="84%">
</colgroup>
<thead><tr class="header">
<th align="left">student_id</th>
<th align="left">class_id</th>
<th align="left">comment_sentences</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">421</td>
<td align="left">A</td>
<td align="left">this class was fun!</td>
</tr>
<tr class="even">
<td align="left">421</td>
<td align="left">A</td>
<td align="left">i would like to continue to work with my final essay and potentially turn in into an honors thesis.</td>
</tr>
<tr class="odd">
<td align="left">421</td>
<td align="left">A</td>
<td align="left">i will contact my professor to find out if this is possibility.</td>
</tr>
<tr class="even">
<td align="left">421</td>
<td align="left">A</td>
<td align="left">thanks!</td>
</tr>
<tr class="odd">
<td align="left">238</td>
<td align="left">B</td>
<td align="left">what shoud i say?</td>
</tr>
<tr class="even">
<td align="left">238</td>
<td align="left">B</td>
<td align="left">i thought i was going to like the class but we did not get to do a final essay.</td>
</tr>
<tr class="odd">
<td align="left">238</td>
<td align="left">B</td>
<td align="left">i was hoping to develop a topic in this class that would help me work towards applying for an honors thesis.</td>
</tr>
</tbody>
</table>
</div>
<p>We see that our data frame has been reshaped by rows –but importantly maintaining the metadata information! In this way our data frame continues to conform to tidy dataset principles.</p>
<p>Of note is the fact that by default <code><a href="https://rdrr.io/pkg/tidytext/man/unnest_tokens.html">unnest_tokens()</a></code> will lowercase the text and drop the original/ input column. We can override one or both of these settings.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">example_df</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/unnest_tokens.html">unnest_tokens</a></span><span class="op">(</span>output <span class="op">=</span> <span class="st">"comment_sentences"</span>, <span class="co"># new column name</span>
                input <span class="op">=</span> <span class="st">"comments"</span>, <span class="co"># input column</span>
                token <span class="op">=</span> <span class="st">"sentences"</span>, <span class="co"># token type to create</span>
                to_lower <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># don't lowercase the output</span>
                drop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># don't drop the input column</span></code></pre></div>
<div class="kable-table">
<table class="table">
<colgroup>
<col width="3%">
<col width="2%">
<col width="61%">
<col width="32%">
</colgroup>
<thead><tr class="header">
<th align="left">student_id</th>
<th align="left">class_id</th>
<th align="left">comments</th>
<th align="left">comment_sentences</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">421</td>
<td align="left">A</td>
<td align="left">This class was fun! I would like to continue to work with my final essay and potentially turn in into an honors thesis. I will contact my professor to find out if this is possibility. Thanks!</td>
<td align="left">This class was fun!</td>
</tr>
<tr class="even">
<td align="left">421</td>
<td align="left">A</td>
<td align="left">This class was fun! I would like to continue to work with my final essay and potentially turn in into an honors thesis. I will contact my professor to find out if this is possibility. Thanks!</td>
<td align="left">I would like to continue to work with my final essay and potentially turn in into an honors thesis.</td>
</tr>
<tr class="odd">
<td align="left">421</td>
<td align="left">A</td>
<td align="left">This class was fun! I would like to continue to work with my final essay and potentially turn in into an honors thesis. I will contact my professor to find out if this is possibility. Thanks!</td>
<td align="left">I will contact my professor to find out if this is possibility.</td>
</tr>
<tr class="even">
<td align="left">421</td>
<td align="left">A</td>
<td align="left">This class was fun! I would like to continue to work with my final essay and potentially turn in into an honors thesis. I will contact my professor to find out if this is possibility. Thanks!</td>
<td align="left">Thanks!</td>
</tr>
<tr class="odd">
<td align="left">238</td>
<td align="left">B</td>
<td align="left">What shoud I say? I thought I was going to like the class but we did not get to do a final essay. I was hoping to develop a topic in this class that would help me work towards applying for an honors thesis.</td>
<td align="left">What shoud I say?</td>
</tr>
<tr class="even">
<td align="left">238</td>
<td align="left">B</td>
<td align="left">What shoud I say? I thought I was going to like the class but we did not get to do a final essay. I was hoping to develop a topic in this class that would help me work towards applying for an honors thesis.</td>
<td align="left">I thought I was going to like the class but we did not get to do a final essay.</td>
</tr>
<tr class="odd">
<td align="left">238</td>
<td align="left">B</td>
<td align="left">What shoud I say? I thought I was going to like the class but we did not get to do a final essay. I was hoping to develop a topic in this class that would help me work towards applying for an honors thesis.</td>
<td align="left">I was hoping to develop a topic in this class that would help me work towards applying for an honors thesis.</td>
</tr>
</tbody>
</table>
</div>
<p>If we do not want to use one of the default token types, we can set the <code>token =</code> to <code>regex</code> and then provide a new argument <code>pattern =</code>. The value for the <code>pattern</code> argument is your own regular expression. So say we wanted to break the <code>comments</code> by periods <code>.</code>, and not question marks or exclamation points, we could do this in this way.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">example_df</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/unnest_tokens.html">unnest_tokens</a></span><span class="op">(</span>output <span class="op">=</span> <span class="st">"comment_sentences"</span>, <span class="co"># new column name</span>
                input <span class="op">=</span> <span class="st">"comments"</span>, <span class="co"># input column</span>
                token <span class="op">=</span> <span class="st">"regex"</span>, <span class="co"># use a regular expression</span>
                pattern <span class="op">=</span> <span class="st">"\\."</span><span class="op">)</span> <span class="co"># specify the regex to use for splitting</span></code></pre></div>
<div class="kable-table">
<table class="table">
<colgroup>
<col width="7%">
<col width="6%">
<col width="85%">
</colgroup>
<thead><tr class="header">
<th align="left">student_id</th>
<th align="left">class_id</th>
<th align="left">comment_sentences</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">421</td>
<td align="left">A</td>
<td align="left">this class was fun! i would like to continue to work with my final essay and potentially turn in into an honors thesis</td>
</tr>
<tr class="even">
<td align="left">421</td>
<td align="left">A</td>
<td align="left">i will contact my professor to find out if this is possibility</td>
</tr>
<tr class="odd">
<td align="left">421</td>
<td align="left">A</td>
<td align="left">thanks!</td>
</tr>
<tr class="even">
<td align="left">238</td>
<td align="left">B</td>
<td align="left">what shoud i say? i thought i was going to like the class but we did not get to do a final essay</td>
</tr>
<tr class="odd">
<td align="left">238</td>
<td align="left">B</td>
<td align="left">i was hoping to develop a topic in this class that would help me work towards applying for an honors thesis</td>
</tr>
</tbody>
</table>
</div>
<p>Note that since this approach uses a regular expression to do the splitting, the regex matches are deleted from the output (i.e. the periods are gone).</p>
<p>Let’s turn to a situation in which our data frame has sentences as the observations.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">example_df</span> <span class="op">&lt;-</span> 
  <span class="va">example_df</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/unnest_tokens.html">unnest_tokens</a></span><span class="op">(</span>output <span class="op">=</span> <span class="st">"comment_sentences"</span>, <span class="co"># new column name</span>
                input <span class="op">=</span> <span class="st">"comments"</span>, <span class="co"># input column</span>
                token <span class="op">=</span> <span class="st">"sentences"</span>, <span class="co"># token type to create</span>
                to_lower <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># don't lowercase the output</span>

<span class="va">example_df</span></code></pre></div>
<div class="kable-table">
<table class="table">
<colgroup>
<col width="8%">
<col width="6%">
<col width="84%">
</colgroup>
<thead><tr class="header">
<th align="left">student_id</th>
<th align="left">class_id</th>
<th align="left">comment_sentences</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">421</td>
<td align="left">A</td>
<td align="left">This class was fun!</td>
</tr>
<tr class="even">
<td align="left">421</td>
<td align="left">A</td>
<td align="left">I would like to continue to work with my final essay and potentially turn in into an honors thesis.</td>
</tr>
<tr class="odd">
<td align="left">421</td>
<td align="left">A</td>
<td align="left">I will contact my professor to find out if this is possibility.</td>
</tr>
<tr class="even">
<td align="left">421</td>
<td align="left">A</td>
<td align="left">Thanks!</td>
</tr>
<tr class="odd">
<td align="left">238</td>
<td align="left">B</td>
<td align="left">What shoud I say?</td>
</tr>
<tr class="even">
<td align="left">238</td>
<td align="left">B</td>
<td align="left">I thought I was going to like the class but we did not get to do a final essay.</td>
</tr>
<tr class="odd">
<td align="left">238</td>
<td align="left">B</td>
<td align="left">I was hoping to develop a topic in this class that would help me work towards applying for an honors thesis.</td>
</tr>
</tbody>
</table>
</div>
<p>And imagine that we want to collapse the sentences grouping them together by the <code>student_id</code> and the <code>class_id</code>, effectively re-creating the original data frame we started with. To do this we turn to our tidyverse tools.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">example_df</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># dataset with comment_sentences column</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">student_id</span>, <span class="va">class_id</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># group by student_id and class_id</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize</a></span><span class="op">(</span>comments <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_flatten.html">str_flatten</a></span><span class="op">(</span>string <span class="op">=</span> <span class="va">comment_sentences</span>, <span class="co"># unite comment_sentences</span>
                                   collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>  <span class="co"># join comment_sentences by a single whitespace character</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># remove grouping attribute on the data frame</span></code></pre></div>
<div class="kable-table">
<table class="table">
<colgroup>
<col width="4%">
<col width="3%">
<col width="91%">
</colgroup>
<thead><tr class="header">
<th align="left">student_id</th>
<th align="left">class_id</th>
<th align="left">comments</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">238</td>
<td align="left">B</td>
<td align="left">What shoud I say? I thought I was going to like the class but we did not get to do a final essay. I was hoping to develop a topic in this class that would help me work towards applying for an honors thesis.</td>
</tr>
<tr class="even">
<td align="left">421</td>
<td align="left">A</td>
<td align="left">This class was fun! I would like to continue to work with my final essay and potentially turn in into an honors thesis. I will contact my professor to find out if this is possibility. Thanks!</td>
</tr>
</tbody>
</table>
</div>
<p><code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> specifies which column(s) should be used to unite the rows. <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code> is similar to <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> in that it creates a new column. It is different, however, in that it will only return the grouping column(s) and the new column created by the operation contained within <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarize()</a></code>. In this case we applied the <code><a href="https://stringr.tidyverse.org/reference/str_flatten.html">str_flatten()</a></code> function, from the stringr package, to unite the <code>comment_sentences</code> column values. The <code>collapse =</code> argument let’s use specify what character(s) should be used to separate the united values.</p>
</div>
</div>
</div>
<div id="case" class="section level2">
<h2 class="hasAnchor">
<a href="#case" class="anchor"></a>Case</h2>
<p>So let’s put these our regular expression and reshaping data skills to work in a practical example. In this case we will be looking at curating data from TV subtitles for the <a href="https://en.wikipedia.org/wiki/Love_on_the_Spectrum">Love on the Spectrum series</a> which is a docuseries following the dating experiences of individuals on the Autism spectrum in Australia.</p>
<p>The data was manually downloaed from <a href="https://www.opensubtitles.org/en/search/subs">Opensubtitles.org</a> and the files we will use are SRT formatted, as seen below.</p>
<pre class="plain"><code>1
00:00:11,160 --&gt; 00:00:13,920
- [man] What do you think love is?
- It'll be like a fairy tale.

2
00:00:14,000 --&gt; 00:00:15,560
A natural high, I suppose?

3
00:00:15,640 --&gt; 00:00:17,160
Gets your heart racing.</code></pre>
<p>This format is used to display the subtitles at the correct moment on the screen so there is information which encodes the sequence of which subtitles to show, the actual timestamp duration which give the precise duration that the subtitle should show, and the text that is to be shown. This text may have conventions to display the text in particular ways and/ or signal cues for the hearing impaired (<code>[man]</code>, for example).</p>
<p>We will first need to read these files into the R session. They are found in this directory structure:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">recipe_7/data/</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived/</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original/</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> love_on_the_spectrum/</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> Love.On.The.Spectrum.S01E01.WEBRip.x264-ION10.srt</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> Love.On.The.Spectrum.S01E02.WEBRip.x264-ION10.srt</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> Love.On.The.Spectrum.S01E03.WEBRip.x264-ION10.srt</span></code></pre></div>
<p>To read in the files I will use the <code><a href="https://rdrr.io/pkg/readtext/man/readtext.html">readtext()</a></code> function. The main argument is <code>file</code> which takes a path to the file(s). In this case I’ve added a wildcard <code>*</code> to allow for the reading of multiple files with the <code>.srt</code> extension. (Note: the <code>*</code> wildcard is not a regular expression convention but it does function much like the regex <code>.*</code>.)</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lots_files</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/readtext/man/readtext.html">readtext</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"recipe_7/data/original/love_on_the_spectrum/*.srt"</span>, <span class="co"># only .srt files</span>
           verbosity <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>  <span class="co"># suppress warnings</span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># convert to a tibble for extended data frame features</span>

<span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">lots_files</span><span class="op">)</span> <span class="co"># preview dataset</span></code></pre></div>
<pre><code>## Rows: 3
## Columns: 2
## $ doc_id &lt;chr&gt; "Love.On.The.Spectrum.S01E01.WEBRip.x264-ION10.srt", "Love.On.T…
## $ text   &lt;chr&gt; "1\n00:00:11,160 --&gt; 00:00:13,920\n- [man] What do you think lo…</code></pre>
<p>From the output of <code><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse()</a></code> we see that the structure of <code>lots_files</code> has two columns <code>doc_id</code> and <code>text</code> and three rows.</p>
<div id="curate-metadata" class="section level3">
<h3 class="hasAnchor">
<a href="#curate-metadata" class="anchor"></a>Curate metadata</h3>
<p>Let’s select just the <code>doc_id</code> column and look at the values.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lots_files</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">doc_id</span><span class="op">)</span>  <span class="co"># only show doc_id</span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">doc_id</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Love.On.The.Spectrum.S01E01.WEBRip.x264-ION10.srt</td>
</tr>
<tr class="even">
<td align="left">Love.On.The.Spectrum.S01E02.WEBRip.x264-ION10.srt</td>
</tr>
<tr class="odd">
<td align="left">Love.On.The.Spectrum.S01E03.WEBRip.x264-ION10.srt</td>
</tr>
</tbody>
</table>
</div>
<p>We see that the names of each of the SRT files appears in the <code>doc_id</code> column. These names have a pattern, such that there is a period <code>.</code> separating each of a number of pieces of information –including the series name, the season, and the episode. Let’s work separate this information into distinct columns effectively expanding the columns in the dataset. The idealized structure will look like the example below.</p>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">series</th>
<th align="left">season</th>
<th align="left">episode</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
</tr>
</tbody>
</table>
</div>
<p>Let’s use the <code><a href="https://tidyr.tidyverse.org/reference/separate.html">separate()</a></code> function and apply it to the <code>doc_id</code> column. If we count up the number of columns that will be created by breaking the values in <code>doc_id</code> by the period <code>.</code> we will have eight columns. We only want to work with the first five, however. Knowing this we can set the argument <code>into</code> to a character vector with the names of five new columns. The <code>sep</code> argument is a period <code>\\.</code> and the extra columns (the remaining three of the eight) are set to be dropped (i.e. not included).</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lots_files_separate</span> <span class="op">&lt;-</span> 
  <span class="va">lots_files</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># dataset</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">doc_id</span>, <span class="co"># column to separate</span>
           into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"name_1"</span>, <span class="st">"name_2"</span>, <span class="st">"name_3"</span>, <span class="st">"name_4"</span>, <span class="st">"name_5"</span><span class="op">)</span>, <span class="co"># new column names</span>
           sep <span class="op">=</span> <span class="st">"\\."</span>, <span class="co"># pattern to separate the column values</span>
           extra <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="co"># drop any extra columns created in the separation</span>

<span class="va">lots_files_separate</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># separated dataset</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">text</span><span class="op">)</span> <span class="co"># do not show the `text` column here</span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">name_1</th>
<th align="left">name_2</th>
<th align="left">name_3</th>
<th align="left">name_4</th>
<th align="left">name_5</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Love</td>
<td align="left">On</td>
<td align="left">The</td>
<td align="left">Spectrum</td>
<td align="left">S01E01</td>
</tr>
<tr class="even">
<td align="left">Love</td>
<td align="left">On</td>
<td align="left">The</td>
<td align="left">Spectrum</td>
<td align="left">S01E02</td>
</tr>
<tr class="odd">
<td align="left">Love</td>
<td align="left">On</td>
<td align="left">The</td>
<td align="left">Spectrum</td>
<td align="left">S01E03</td>
</tr>
</tbody>
</table>
</div>
<p>Now we have five new columns that were derived from the <code>doc_id</code> column. Note that the names for the columns were arbitrary. Since I know that we will be doing more changes to the columns I did not worry about creating meaningful column names.</p>
<p>The <code>name_5</code> column contans the season and episode information. We want to break this column up into two columns for each of these pieces of information. To do this we look at the values in <code>name_5</code> and see if there is some way to split/ separate the values that is consistent. It turns out we can use the ‘E’ for episode to separate the values between season and episode.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lots_files_separate</span> <span class="op">&lt;-</span> 
  <span class="va">lots_files_separate</span>  <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># dataset</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">name_5</span>, <span class="co"># column to separate</span>
           into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"season"</span>, <span class="st">"episode"</span><span class="op">)</span>, <span class="co"># new columns</span>
           sep <span class="op">=</span> <span class="st">"E"</span><span class="op">)</span> <span class="co"># pattern to use to separate the values</span>

<span class="va">lots_files_separate</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># separated dataset</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">text</span><span class="op">)</span> <span class="co"># do not show the `text` column here</span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">name_1</th>
<th align="left">name_2</th>
<th align="left">name_3</th>
<th align="left">name_4</th>
<th align="left">season</th>
<th align="left">episode</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Love</td>
<td align="left">On</td>
<td align="left">The</td>
<td align="left">Spectrum</td>
<td align="left">S01</td>
<td align="left">01</td>
</tr>
<tr class="even">
<td align="left">Love</td>
<td align="left">On</td>
<td align="left">The</td>
<td align="left">Spectrum</td>
<td align="left">S01</td>
<td align="left">02</td>
</tr>
<tr class="odd">
<td align="left">Love</td>
<td align="left">On</td>
<td align="left">The</td>
<td align="left">Spectrum</td>
<td align="left">S01</td>
<td align="left">03</td>
</tr>
</tbody>
</table>
</div>
<p>The new columns <code>season</code> and <code>episode</code> appear now.</p>
<p>Let’s now create the <code>series</code> column by uniting the first four columns (i.e. <code>name_1</code> through <code>name_4</code>). We can use the <code><a href="https://tidyr.tidyverse.org/reference/unite.html">unite()</a></code> function for this. <code><a href="https://tidyr.tidyverse.org/reference/unite.html">unite()</a></code> needs the name of the new column (<code>col</code>), a vector of the columns to unite (in this case <code>name_1:name_4</code>, which is equivalent to <code>c(name_1, name_2, name_3, name_4)</code>), and the separator for the new values (<code>sep</code>).</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lots_files_unite</span> <span class="op">&lt;-</span> 
  <span class="va">lots_files_separate</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># dataset</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html">unite</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"series"</span>, <span class="co"># new column name</span>
        <span class="va">name_1</span><span class="op">:</span><span class="va">name_4</span>, <span class="co"># columns to unite</span>
        sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span> <span class="co"># separator to add between of the column values</span>

<span class="va">lots_files_unite</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># united dataset</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">text</span><span class="op">)</span> <span class="co"># do not show the `text` column here</span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">series</th>
<th align="left">season</th>
<th align="left">episode</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">S01</td>
<td align="left">01</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">S01</td>
<td align="left">02</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">S01</td>
<td align="left">03</td>
</tr>
</tbody>
</table>
</div>
<p>The last thing to do is to clean up the <code>season</code> column values by removing the ‘S’ before each season number. We can just use the <code><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove()</a></code>. Notice that we use the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> function to modify columns, in this case we are going to modify the <code>season</code> column and then we are going to overwrite the existing <code>season</code> column with the results of <code><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove()</a></code>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lots_meta</span> <span class="op">&lt;-</span> 
  <span class="va">lots_files_unite</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># dataset</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>season <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">season</span>, <span class="st">"S"</span><span class="op">)</span><span class="op">)</span> <span class="co"># remove 'S' in season and overwrite existing season column</span>

<span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">lots_meta</span><span class="op">)</span> <span class="co"># preview full dataset</span></code></pre></div>
<pre><code>## Rows: 3
## Columns: 4
## $ series  &lt;chr&gt; "Love On The Spectrum", "Love On The Spectrum", "Love On The S…
## $ season  &lt;chr&gt; "01", "01", "01"
## $ episode &lt;chr&gt; "01", "02", "03"
## $ text    &lt;chr&gt; "1\n00:00:11,160 --&gt; 00:00:13,920\n- [man] What do you think l…</code></pre>
<p>Great! We now have the metadata information curated as we aimed to do.</p>
</div>
<div id="curate-text" class="section level3">
<h3 class="hasAnchor">
<a href="#curate-text" class="anchor"></a>Curate text</h3>
<p>It’s now time to turn our attention to working with the <code>text</code> column. Let’s take a look at the first 500 characters in the first observation of the <code>text</code> column.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lots_meta</span><span class="op">$</span><span class="va">text</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># subset the first observation of the text column</span>
  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trunc.html">str_trunc</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># truncate the values to 500 characters</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># print the characters for inspection</span></code></pre></div>
<pre><code>1
00:00:11,160 --&gt; 00:00:13,920
- [man] What do you think love is?
- It'll be like a fairy tale.

2
00:00:14,000 --&gt; 00:00:15,560
A natural high, I suppose?

3
00:00:15,640 --&gt; 00:00:17,160
Gets your heart racing.

4
00:00:17,240 --&gt; 00:00:19,600
Can make people do crazy things.

5
00:00:19,680 --&gt; 00:00:23,320
You just feel very warm inside yourself
as a person.

6
00:00:23,400 --&gt; 00:00:25,360
- [man] So, have you ever been in love?
- No.

7
00:00:25,440 --&gt; 00:00:27,240
- [man] Have you be...</code></pre>
<p>What we see from the above output is that each row in the <code>text</code> column has the dialogue for each series, season, and episode in each row. We also see that this dialogue is not conducive to language research given the SRT formatting. Ideally we would like to clean this SRT information (sequence, timestamps, and other non-linguistic cues) and only retain the dialogue.</p>
<p>So an idealized dataset for this data would look something like this:</p>
<div class="kable-table">
<table class="table">
<colgroup>
<col width="10%">
<col width="3%">
<col width="3%">
<col width="82%">
</colgroup>
<thead><tr class="header">
<th align="left">series</th>
<th align="left">season</th>
<th align="left">episode</th>
<th align="left">dialogue</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">It’ll be like a fairy tale. A natural high, I suppose? Gets your heart racing. Can make people do crazy things. You just feel very warm inside yourself as a person. …</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left">I’ve never actually dated anyone in the past. I’ve been dreaming about marriage for years, ever since I left school. I do feel like I’m ready. …</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left">What do you think love is? It can make people do crazy things that they wouldn’t think of doing, make them act all bizarre. …</td>
</tr>
</tbody>
</table>
</div>
<p>So, before we get started we should think about how we could go about getting to this idealized format given the format of the text and the R programming strategies at our disposal.</p>
<p>First, it is always a good idea to look at closely at the internal structure of the text. Looking at the text we can see that each observation in <code>text</code> has a series of lines, separated by <code>\n</code>.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lots_files</span><span class="op">$</span><span class="va">text</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># first observation of the `text` column</span>
  <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trunc.html">str_trunc</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">200</span><span class="op">)</span> <span class="co"># only show the first 200 characters</span></code></pre></div>
<pre><code>## [1] "1\n00:00:11,160 --&gt; 00:00:13,920\n- [man] What do you think love is?\n- It'll be like a fairy tale.\n\n2\n00:00:14,000 --&gt; 00:00:15,560\nA natural high, I suppose?\n\n3\n00:00:15,640 --&gt; 00:00:17,160\nGets yo..."</code></pre>
<p>For the most part the distinct lines contain either dialogue or SRT conventions for displaying subtitles on a screen. So a potential first step to cleaning this data could be to split each observation into lines. We can do this by using the <code><a href="https://rdrr.io/pkg/tidytext/man/unnest_tokens.html">unnest_tokens()</a></code> function and use a regular expression to separate by new line anchors <code>\\n</code>.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lots_meta_lines</span> <span class="op">&lt;-</span> 
  <span class="va">lots_meta</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># dataset with `text` column</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/unnest_tokens.html">unnest_tokens</a></span><span class="op">(</span>output <span class="op">=</span> <span class="va">lines</span>, <span class="co"># new column</span>
                input <span class="op">=</span> <span class="va">text</span>, <span class="co"># input column</span>
                token <span class="op">=</span> <span class="st">"regex"</span>, <span class="co"># use regular expression to split</span>
                pattern <span class="op">=</span> <span class="st">"\\n"</span>, <span class="co"># split by new line anchor</span>
                to_lower <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># do not lowercase the text</span>

<span class="va">lots_meta_lines</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># dataset</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co"># preview first 10 observations</span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">series</th>
<th align="left">season</th>
<th align="left">episode</th>
<th align="left">lines</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">00:00:11,160 –&gt; 00:00:13,920</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">- [man] What do you think love is?</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">- It’ll be like a fairy tale.</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">2</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">00:00:14,000 –&gt; 00:00:15,560</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">A natural high, I suppose?</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">3</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">00:00:15,640 –&gt; 00:00:17,160</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">Gets your heart racing.</td>
</tr>
</tbody>
</table>
</div>
<p>We can see from the first 10 observations that there is a consistent pattern in which the lines that start with a digit are not dialogue. It’s worthwhile to open one or more of the original <code>.srt</code> files in a text editor (in RStudio or some other text editing software) to ensure this is the case.</p>
<p>On my inspection it does look like it is safe to target lines starting with digits to remove. Just as a sanity check, however, we can instead search for all the lines that start with digits and make sure that we do not get something that we would like to keep.</p>
<p>To search for lines that start with digits, we can craft a regular expression to use with the <code><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect()</a></code> function. This will return a logical value, <code>TRUE</code> if there’s a match, <code>FALSE</code> otherwise. Wrapping <code><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect()</a></code> with <code><a href="https://dplyr.tidyverse.org/reference/filter.html">filter()</a></code> will filter for only rows that return <code>TRUE</code>.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lots_meta_lines</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># dataset</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^\\d"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># detect lines starting with  a digit</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co"># a random sample 10 observations from the entire dataset</span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">series</th>
<th align="left">season</th>
<th align="left">episode</th>
<th align="left">lines</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left">00:31:42,440 –&gt; 00:31:43,280</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left">254</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left">723</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left">00:29:12,200 –&gt; 00:29:14,480</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left">00:38:05,440 –&gt; 00:38:06,560</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left">438</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">00:28:36,640 –&gt; 00:28:38,320</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left">00:36:03,480 –&gt; 00:36:05,920</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">518</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">540</td>
</tr>
</tbody>
</table>
</div>
<p>Looks like this is a safe move. Let’s go ahead and remove these lines. We could use <code><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove()</a></code> which would require that we match the entire pattern (line) we want to remove –or we can just leverage the search we just did and reverse the logical value to <code>FALSE</code> when it matches. Remember we can do this by adding the <code>!</code> operator in front of the <code><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect()</a></code> function as it returns a logical value.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lots_meta_lines</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># dataset</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^\\d"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># detect lines starting with a digit and remove them</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co"># first 10 observations</span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">series</th>
<th align="left">season</th>
<th align="left">episode</th>
<th align="left">lines</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">- [man] What do you think love is?</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">- It’ll be like a fairy tale.</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">A natural high, I suppose?</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">Gets your heart racing.</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">Can make people do crazy things.</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">You just feel very warm inside yourself</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">as a person.</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">- [man] So, have you ever been in love?</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">- No.</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">- [man] Have you been in a relationship?</td>
</tr>
</tbody>
</table>
</div>
<p>Great. Let’s add to this code and continue to clean the text. The next aspect I we want to get rid of is the hyphens starting some lines. Let’s get rid of these. To do this we <em>do</em> need to use <code><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove()</a></code> as we are just removing a portion of the line, namely the pattern captured by <code>^-\\s</code> (hyphens at the beginning of the line followed by a single whitespace).</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lots_meta_lines</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># dataset</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^\\d"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># detect lines starting with a digit and remove them</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^-\\s"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove leading '- ' from each line</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co"># first 10 observations</span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">series</th>
<th align="left">season</th>
<th align="left">episode</th>
<th align="left">lines</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">[man] What do you think love is?</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">It’ll be like a fairy tale.</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">A natural high, I suppose?</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">Gets your heart racing.</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">Can make people do crazy things.</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">You just feel very warm inside yourself</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">as a person.</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">[man] So, have you ever been in love?</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">No.</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">[man] Have you been in a relationship?</td>
</tr>
</tbody>
</table>
</div>
<p>Great. The ‘-’ leading each line are now gone.</p>
<p>Let’s now explore what’s going on with the lines that start with <code>[</code> which appear to include cues about who is speaking. In the cases we see in the first 10 observations we only see <code>[man]</code>, but let’s search lines starting with <code>[</code> to find out if there are any other examples of this cue in the text. Since the <code>[</code> character means something in regular expressions we will need to escape it. So we will use the expression <code>^\\[</code>.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lots_meta_lines</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># dataset</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^\\d"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># detect lines starting with a digit and remove them</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^-\\s"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove leading '- ' from each line</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^\\["</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># find lines starting with `[`</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co"># random sample of 10 observations</span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">series</th>
<th align="left">season</th>
<th align="left">episode</th>
<th align="left">lines</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">[mother] She’ll be impressed.</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">[man] What’s your guess</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left">[inhales] I suppose.</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left">[Severin] Yeah.</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left">[Maddi chuckles]</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">[both laugh]</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left">[father] Nice work.</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">[father] Good. Now get outta here.</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left">[Kelvin] Ooh!</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left">[Michael] <i>I’ve never actually dated anyone</i>
</td>
</tr>
</tbody>
</table>
</div>
<p>Running the above code a couple of times in R Markdown, I get different samples of lines starting with <code>[</code>. From these results it seems like the brackets are used at the beginning of lines to signal a few types of cues. Most of them we want to remove –but we don’t want to remove those where there are proper names. These names have a capital letter just inside the <code>[</code>. Let’s use a regular expression to filter lines out that start with <code>[</code> followed by a lowercase letter. This regular expression is <code>^\\[[a-z]</code>.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lots_meta_lines</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># dataset</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^\\d"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># detect lines starting with a digit and remove them</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^-\\s"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove leading '- ' from each line</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^\\[[a-z]"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove lines starting with `[` before a lowercase letter</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co"># random sample of 10 observations</span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">series</th>
<th align="left">season</th>
<th align="left">episode</th>
<th align="left">lines</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left">Um…</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left">so well for you, Kelvin?</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left">Uh, yes. Um, you want to check out</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left">though.</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left">who loves him for who he is.</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left">That’s the costume.</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">Yeah, I do.</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">Yeah. Yes.</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">Do you have any hobbies?</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">My, um…</td>
</tr>
</tbody>
</table>
</div>
<p>Now that we have removed lines that were clearly marked as cues that were not dialogue from the speakers we are interested in, we can now remove any other cases where there is text inside brackets, <code>[David laughs]</code> for example. Let’s try to search and <em>extract</em> this pattern. To isolate this pattern and only return the match we will use the <code><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract()</a></code> function. This will match a regular expression pattern and return only the complete match. To be able to evaluate whether this pattern is working I will use <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> to assign the matches to a new column variable for easier comparison with the original text in the <code>lines</code> column.</p>
<p>Let’s start with the pattern <code>\\[.+\\]</code></p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lots_meta_lines</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># dataset</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^\\d"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># detect lines starting with a digit and remove them</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^-\\s"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove leading '- ' from each line</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^\\[[a-z]"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove lines starting with `[` before a lowercase letter</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>match <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html">str_extract</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"\\[.+\\]"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># search for cues inside of brackets ex. [man]</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co"># random sample of 10 observations</span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">series</th>
<th align="left">season</th>
<th align="left">episode</th>
<th align="left">lines</th>
<th align="left">match</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">Or practically any girl that acts like…</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left"><font color="#ffff00">Subtitles Diego Moraes(oakislandtk)</font></td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left">Oh, she’s really nice and very sweet,</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left">Right there, the guy with the dark hair.</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">in a… in a strange way.</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left">Mmm-mmm.</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left">Yeah. It’s been a long day.</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left">…as long as we’re getting</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left">Yeah. It will happen.</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">You know what I mean?</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
</div>
<p>The <code>\\[.+\\]</code> regex appears to do what we want, so now let’s apply it to remove these cues. In this case again will use <code><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove()</a></code> because we are removing characters within a line, not the entire line. But since there may be more than one instance of the pattern in a single line, we will use the <code><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all()</a></code> function.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lots_meta_lines</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># dataset</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^\\d"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># detect lines starting with a digit and remove them</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^-\\s"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove leading '- ' from each line</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^\\[[a-z]"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove lines starting with `[` before a lowercase letter</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"\\[.+\\]"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove cues inside of brackets ex. [man]</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co"># random sample of 10 observations</span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">series</th>
<th align="left">season</th>
<th align="left">episode</th>
<th align="left">lines</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left">for my large heart,</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">You go for… go for a wee.</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">And here I am,</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left"><i>He’s about to meet his perfect woman.</i></td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left">The laptop.</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">Oh, no, you can keep it.</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left">Greeting. Greeting.</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left">Good thing…</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">I’d like to catch up with you</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">because we just have to keep finding…</td>
</tr>
</tbody>
</table>
</div>
<p>The text in <code>lines</code> is looking pretty clean. Let’s check to see if there are any other patterns that might signal artifacts that we might want to eliminate from the dialogue. Let’s see if there are any lines that start with non-alphabetic or non-digit characters. We can accomplish this with the <code>^\\W</code> expression.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lots_meta_lines</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># dataset</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^\\d"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># detect lines starting with a digit and remove them</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^-\\s"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove leading '- ' from each line</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^\\[[a-z]"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove lines starting with `[` before a lowercase letter</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"\\[.+\\]"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove cues inside of brackets ex. [man]</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^\\W"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># search lines starting with non-word character</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co"># random sample of 10 observations</span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">series</th>
<th align="left">season</th>
<th align="left">episode</th>
<th align="left">lines</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left">Would you like to go out with a guy</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left">You know who these guys are?</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left"><i>Last time I was down there,</i></td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left"><i>Bon appétit!</i></td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left">Leaving now.</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left">What do you think love is?</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">Mm-hmm.</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">That’s what I wanna hear.</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left"><i>hoping to learn skills that will help him</i></td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left">Mmm, hmm.</td>
</tr>
</tbody>
</table>
</div>
<p>Running the above code a few times to get a sample of what the <code>^\\W</code> pattern matches we get results which are clearly artifacts (‘&lt;i&gt;’) and some other which do not ‘Yes.’ So let’s play it safe and not filter by non-word character, but instead remove lines that start what appear to be HTML tags ‘&lt;tag&gt;.’ The regular expression I’ve worked out for this is <code>^&lt;.+?&gt;.*</code>.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lots_meta_lines</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># dataset</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^\\d"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># detect lines starting with a digit and remove them</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^-\\s"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove leading '- ' from each line</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^\\[[a-z]"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove lines starting with `[` before a lowercase letter</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"\\[.+\\]"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove cues inside of brackets ex. [man]</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^&lt;.+?&gt;.*"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove lines starting with HTML tags</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co"># random sample of 10 observations</span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">series</th>
<th align="left">season</th>
<th align="left">episode</th>
<th align="left">lines</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left">Changed your mind a bit?</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">No, you’re cheeky.</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left">In the mating season,</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">I don’t seem to recall Adam</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left">Here’s your chair, Jodi.</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left">It’s an Ankylosaurus.</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left">With… with the questions.</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">A lot of things happen</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left">Even international dating sites.</td>
</tr>
</tbody>
</table>
</div>
<p>Alright. This text is almost as clean as it’s going to get. I did notice on inspection that there were ‘&lt;i&gt;…&lt;/i&gt;’ tags around some words, but they were words used by the target speakers. So let’s keep the text inside but remove the leading and trailing tag with this expression <code>&lt;.+?&gt;</code>.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lots_meta_lines</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># dataset</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^\\d"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># detect lines starting with a digit and remove them</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^-\\s"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove leading '- ' from each line</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^\\[[a-z]"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove lines starting with `[` before a lowercase letter</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"\\[.+\\]"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove cues inside of brackets ex. [man]</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^&lt;.+?&gt;.*"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove lines starting with HTML tags</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"&lt;.+?&gt;"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>  <span class="co"># remove all HTML tags</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="co"># random sample of 10 observations</span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">series</th>
<th align="left">season</th>
<th align="left">episode</th>
<th align="left">lines</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left">Oops.</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left">so well for you, Kelvin?</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left">Thanks.</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left">This is Suzuha Amane.</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">It won’t be touching, I promise.</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left">Oh, yes.</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left">That’s enough for now, okay?</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">She’s funny, fun to be with, um…</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left">Yes.</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left">So is that okay that she likes</td>
</tr>
</tbody>
</table>
</div>
<p>Now we can assign the work we have done step-by-step to clean the data to a new data frame <code>lots_meta_lines_clean</code>.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lots_meta_lines_clean</span> <span class="op">&lt;-</span> 
  <span class="va">lots_meta_lines</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># dataset</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^\\d"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># detect lines starting with a digit and remove them</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^-\\s"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove leading '- ' from each line</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^\\[[a-z]"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove lines starting with `[` before a lowercase letter</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"\\[.+\\]"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove cues inside of brackets ex. [man]</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^&lt;.+?&gt;.*"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove lines starting with HTML tags</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"&lt;.+?&gt;"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># remove all HTML tags</span></code></pre></div>
<p>The final step to curate this data into the structure we had idealized is to collapse the <code>lines</code> column into <code>dialogue</code> grouping by <code>series</code>, <code>season</code>, and <code>episode</code>.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lots_curated</span> <span class="op">&lt;-</span> 
  <span class="va">lots_meta_lines_clean</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># dataset</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">series</span>, <span class="va">season</span>, <span class="va">episode</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># grouping</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>dialogue <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_flatten.html">str_flatten</a></span><span class="op">(</span><span class="va">lines</span>, collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># collapse lines single observations for each series, season, episode combination</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove grouping attributes</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dialogue <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_trim</a></span><span class="op">(</span><span class="va">dialogue</span>, side <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span><span class="op">)</span> <span class="co"># trim any leading or trailing whitespace from the united/ flattened lines in dialogue</span></code></pre></div>
<p>So here’s how the dataset looks now, with <code>dialogue</code> truncated to 200 characters for display here only.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lots_curated</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># curated dataset</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dialogue <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trunc.html">str_trunc</a></span><span class="op">(</span><span class="va">dialogue</span>, <span class="fl">200</span><span class="op">)</span><span class="op">)</span> <span class="co"># just show first 200 characters of dialogue</span></code></pre></div>
<div class="kable-table">
<table class="table">
<colgroup>
<col width="8%">
<col width="2%">
<col width="3%">
<col width="84%">
</colgroup>
<thead><tr class="header">
<th align="left">series</th>
<th align="left">season</th>
<th align="left">episode</th>
<th align="left">dialogue</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">01</td>
<td align="left">It’ll be like a fairy tale. A natural high, I suppose? Gets your heart racing. Can make people do crazy things. You just feel very warm inside yourself as a person. No. No. No. That was too awkward…</td>
</tr>
<tr class="even">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">02</td>
<td align="left">I’ve never actually dated anyone for years, ever since I left school. Little nervous. Just butterflies. She won’t see it there. Hey! Hello, Amanda. How are you? Oh, please, allow me. Thank you. I’…</td>
</tr>
<tr class="odd">
<td align="left">Love On The Spectrum</td>
<td align="left">01</td>
<td align="left">03</td>
<td align="left">What do you think love is? It can make people do crazy things that they wouldn’t think of doing, make them act all bizarre. I think it requires, um, communication, honesty, and compromise. with his…</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="write-and-document" class="section level3">
<h3 class="hasAnchor">
<a href="#write-and-document" class="anchor"></a>Write and document</h3>
<p>The last things to do are to write the curated dataset <code>lots_curated</code> to disk and to create a data dictionary.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="http://fs.r-lib.org/reference/create.html">dir_create</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"recipe_7/data/derived/love_on_the_spectrum/"</span><span class="op">)</span>
<span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">lots_curated</span>, <span class="co"># curated dataset</span>
          file <span class="op">=</span> <span class="st">"recipe_7/data/derived/love_on_the_spectrum/lots_curated.csv"</span><span class="op">)</span></code></pre></div>
<p>I’m going to add the function described in the <a href="https://lin380.github.io/coursebook/curate-data.html#documentation-2">Text as Data coursebook</a>.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data_dic_starter</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">file_path</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Function:</span>
  <span class="co"># Creates a .csv file with the basic information</span>
  <span class="co"># to document a curated dataset</span>
  
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>variable_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, <span class="co"># column with existing variable names </span>
       name <span class="op">=</span> <span class="st">""</span>, <span class="co"># column for human-readable names</span>
       description <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># column for prose description</span>
  <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">file_path</span><span class="op">)</span> <span class="co"># write to disk</span>
<span class="op">}</span></code></pre></div>
<p>Now I’m going to call the <code>data_dic_starter()</code> on the <code>lots_curated</code> dataset and then open the file in a spreadsheet software and add human-readable variable names and descriptions for each file.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">data_dic_starter</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lots_curated</span>, <span class="co"># curated dataset</span>
                 file_path <span class="op">=</span> <span class="st">"recipe_7/data/derived/love_on_the_spectrum/lots_curated_data_dictionary.csv"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb52"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="ex">recipe_7/data/</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="ex">├──</span> derived/</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>   └── love_on_the_spectrum/</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>       ├── lots_curated.csv</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="ex">│</span>       └── lots_curated_data_dictionary.csv</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> original/</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    <span class="ex">└──</span> love_on_the_spectrum/</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> Love.On.The.Spectrum.S01E01.WEBRip.x264-ION10.srt</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>        <span class="ex">├──</span> Love.On.The.Spectrum.S01E02.WEBRip.x264-ION10.srt</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>        <span class="ex">└──</span> Love.On.The.Spectrum.S01E03.WEBRip.x264-ION10.srt</span></code></pre></div>
<p>To summarize this quite long case, I’ve included a more concise form of the code to curate the Love on the Spectrum SRT files.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Read the SRT files</span>
<span class="va">lots_files</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/readtext/man/readtext.html">readtext</a></span><span class="op">(</span>file <span class="op">=</span> <span class="st">"recipe_7/data/original/love_on_the_spectrum/*.srt"</span>, <span class="co"># only .srt files</span>
           verbosity <span class="op">=</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>  <span class="co"># suppress warnings</span>
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># convert to a tibble for extended data frame features</span>

<span class="co"># Curate metadata</span>
<span class="va">lots_meta</span> <span class="op">&lt;-</span> 
  <span class="va">lots_files</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># dataset</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">doc_id</span>, <span class="co"># column to separate</span>
           into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"name_1"</span>, <span class="st">"name_2"</span>, <span class="st">"name_3"</span>, <span class="st">"name_4"</span>, <span class="st">"name_5"</span><span class="op">)</span>, <span class="co"># new column names</span>
           sep <span class="op">=</span> <span class="st">"\\."</span>, <span class="co"># pattern to separate the column values</span>
           extra <span class="op">=</span> <span class="st">"drop"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>  <span class="co"># drop any extra columns created in the separation</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/separate.html">separate</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">name_5</span>, <span class="co"># column to separate</span>
           into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"season"</span>, <span class="st">"episode"</span><span class="op">)</span>, <span class="co"># new columns</span>
           sep <span class="op">=</span> <span class="st">"E"</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>  <span class="co"># pattern to use to separate the values</span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/unite.html">unite</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">"series"</span>, <span class="co"># new column name</span>
        <span class="va">name_1</span><span class="op">:</span><span class="va">name_4</span>, <span class="co"># columns to unite</span>
        sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span>  <span class="co"># separator to add between of the column values</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>season <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">season</span>, <span class="st">"S"</span><span class="op">)</span><span class="op">)</span> <span class="co"># remove 'S' in season and overwrite existing season column</span>

<span class="co"># Curate text</span>
<span class="co"># Clean text by lines</span>
<span class="va">lots_meta_lines</span> <span class="op">&lt;-</span> 
  <span class="va">lots_meta</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># dataset with `text` column</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tidytext/man/unnest_tokens.html">unnest_tokens</a></span><span class="op">(</span>output <span class="op">=</span> <span class="va">lines</span>, <span class="co"># new column</span>
                input <span class="op">=</span> <span class="va">text</span>, <span class="co"># input column</span>
                token <span class="op">=</span> <span class="st">"regex"</span>, <span class="co"># use regular expression to split</span>
                pattern <span class="op">=</span> <span class="st">"\\n"</span>, <span class="co"># split by new line anchor</span>
                to_lower <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># do not lowercase the text</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^\\d"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># detect lines starting with a digit and remove them</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^-\\s"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove leading '- ' from each line</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^\\[[a-z]"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove lines starting with `[` before a lowercase letter</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"\\[.+\\]"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove cues inside of brackets ex. [man]</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_detect.html">str_detect</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"^&lt;.+?&gt;.*"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove lines starting with HTML tags</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>lines <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_remove.html">str_remove_all</a></span><span class="op">(</span><span class="va">lines</span>, <span class="st">"&lt;.+?&gt;"</span><span class="op">)</span><span class="op">)</span>  <span class="co"># remove all HTML tags</span>

<span class="co"># Collapse lines by series, season, and episode</span>
<span class="va">lots_curated</span> <span class="op">&lt;-</span> 
  <span class="va">lots_meta_lines</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">series</span>, <span class="va">season</span>, <span class="va">episode</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># grouping</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>dialogue <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_flatten.html">str_flatten</a></span><span class="op">(</span><span class="va">lines</span>, collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># collapse lines single observations for each series, season, episode combination</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># remove grouping attributes</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dialogue <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_trim.html">str_trim</a></span><span class="op">(</span><span class="va">dialogue</span>, side <span class="op">=</span> <span class="st">"both"</span><span class="op">)</span><span class="op">)</span> <span class="co"># trim any leading or trailing whitespace from the united/ flattened lines in dialogue</span>

<span class="co"># Write the dataset to disk</span>
<span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="http://fs.r-lib.org/reference/create.html">dir_create</a></span><span class="op">(</span>path <span class="op">=</span> <span class="st">"recipe_7/data/derived/love_on_the_spectrum/"</span><span class="op">)</span>
<span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">lots_curated</span>, <span class="co"># curated dataset</span>
          file <span class="op">=</span> <span class="st">"recipe_7/data/derived/love_on_the_spectrum/lots_curated.csv"</span><span class="op">)</span>

<span class="co"># Create data dictionary to open and edit</span>
<span class="va">data_dic_starter</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">file_path</span><span class="op">)</span> <span class="op">{</span>
  <span class="co"># Function:</span>
  <span class="co"># Creates a .csv file with the basic information</span>
  <span class="co"># to document a curated dataset</span>
  
  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>variable_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, <span class="co"># column with existing variable names </span>
       name <span class="op">=</span> <span class="st">""</span>, <span class="co"># column for human-readable names</span>
       description <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op"><a href="../reference/%&gt;%.html">%&gt;%</a></span> <span class="co"># column for prose description</span>
  <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="va">file_path</span><span class="op">)</span> <span class="co"># write to disk</span>
<span class="op">}</span>

<span class="fu">data_dic_starter</span><span class="op">(</span>data <span class="op">=</span> <span class="va">lots_curated</span>, 
                 file_path <span class="op">=</span> <span class="st">"recipe_7/data/derived/love_on_the_spectrum/lots_curated_data_dictionary.csv"</span><span class="op">)</span></code></pre></div>
<p>Wow! That was quite the journey.</p>
</div>
</div>
<div id="summary" class="section level2">
<h2 class="hasAnchor">
<a href="#summary" class="anchor"></a>Summary</h2>
<p>In this Recipe we, again, covered a lot of ground. Key programming strategies that were included were regular expressions and reshaping data. In the process we reviewed and extended the use of many functions from the tidyverse meta-package and also included a very powerful function <code><a href="https://rdrr.io/pkg/tidytext/man/unnest_tokens.html">unnest_tokens()</a></code> from the tidytext package. We will continue to work with these principles and packages in the next recipe when we move to refine our curated dataset to align directly with our analysis method.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jerid Francom.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
