<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="tadr">
<title>6. Control statements, custom functions, and iteration • Text as Data Resources</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<script src="../extra.js"></script><meta property="og:title" content="6. Control statements, custom functions, and iteration">
<meta property="og:description" content="tadr">
<meta property="og:image" content="https://lin380.github.io/tadr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-P69131XJC0"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-P69131XJC0');
</script>
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">Text as Data Resources</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../tutorials/index.html">Tutorials</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/lin380/tadr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">


<div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>6. Control statements, custom functions, and iteration</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/lin380/tadr/blob/HEAD/vignettes/recipe_6.Rmd" class="external-link"><code>vignettes/recipe_6.Rmd</code></a></small>
      <div class="d-none name"><code>recipe_6.Rmd</code></div>
    </div>

    
    
<!-- TODOS:

- Complete webscraping example
  - One online news page, create function then apply to another page on the same site
- Add citations for the packages (rtweet, purrr, rvest)

-->
<!-- 
Note: These recipes are dedicated to expanding the application of the programming strategies needed to support accomplishing goals at distinct points. Keep that in mind when developing the subsequent recipes. 
-->
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>In this Recipe, we will dive into some R strategies that will increase your ability to produce effective, concise, and reproducible code. The three main areas we will cover are working with control statements, writing custom functions, and leveraging iteration. These programming strategies are often useful for acquiring data but, as we will see, they are powerful concepts that can be used throughout a reproducible research project.</p>
<p>To illustrate the usefulness of these R coding strategies I will provide two data collection cases: One using the rtweet pacakge to collect data from Twitter and the second using the rvest package to perform webscraping.</p>
<p>To get started let’s load the main packages we will work with in this recipe.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>  <span class="co"># data manipulation</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://CRAN.R-project.org/package=rtweet" class="external-link">rtweet</a></span><span class="op">)</span>  <span class="co"># collecting tweets from Twitter API</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rvest.tidyverse.org/" class="external-link">rvest</a></span><span class="op">)</span>  <span class="co"># webscraping</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://purrr.tidyverse.org" class="external-link">purrr</a></span><span class="op">)</span>  <span class="co"># iteration</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="coding-strategies">Coding strategies<a class="anchor" aria-label="anchor" href="#coding-strategies"></a>
</h2>
<p>In this section I will discuss control statments, custom functions, and iteration providing general understanding of how each work to develop effective and efficient R coding practices.</p>
<div class="section level3">
<h3 id="control-statements">Control statements<a class="anchor" aria-label="anchor" href="#control-statements"></a>
</h3>
<p>In programming in general, and in R in particular, it is often the case that there will be points in the code in which the programmer will want to have the code make decisions on what to process (and what not to process) based on some state of the current code.</p>
<p>So when we want to make a choice point we need to frame that as an operation that returns a logical (TRUE/FALSE) output.</p>
<p>For example, let’s set a variable <code>x</code> to <code>1</code>. An then ask R to evaluate <code>x</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">1</span>  <span class="co"># set x to 1</span>
<span class="va">x</span> <span class="op">==</span> <span class="fl">1</span>  <span class="co"># evaluate x is equal to 1</span></code></pre></div>
<pre><code><span class="co">## [1] TRUE</span></code></pre>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">x</span> <span class="op">!=</span> <span class="fl">1</span>  <span class="co"># evaluate x is not equal to 1</span></code></pre></div>
<pre><code><span class="co">## [1] FALSE</span></code></pre>
<p>The same applies to character values.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">y</span> <span class="op">&lt;-</span> <span class="st">"Delwin"</span>  <span class="co"># set y to Delwin</span>
<span class="va">y</span> <span class="op">==</span> <span class="st">"Delwin"</span>  <span class="co"># evaluate y is equal to Delwin</span></code></pre></div>
<pre><code><span class="co">## [1] TRUE</span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">y</span> <span class="op">!=</span> <span class="st">"Delwin"</span>  <span class="co"># evaluate y is not equal to Delwin</span></code></pre></div>
<pre><code><span class="co">## [1] FALSE</span></code></pre>
<p>Any operation that returns a logical value can be used. In the above example we used <a href="https://bookdown.org/manishpatwal/bookdown-demo/basic-operations-in-r.html#relational-operators-in-r" class="external-link">relational operators</a>, but any function that returns a logical value can be used too.</p>
<p>There are a set of functions that come with the stringr package that allow us to evaluate character values in various ways. Let’s evaluate whether <code>y</code> starts with the letter “D”.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_starts.html" class="external-link">str_starts</a></span><span class="op">(</span><span class="va">y</span>, <span class="st">"D"</span><span class="op">)</span>  <span class="co"># evaluate y starts with D</span></code></pre></div>
<pre><code><span class="co">## [1] TRUE</span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_starts.html" class="external-link">str_starts</a></span><span class="op">(</span><span class="va">y</span>, <span class="st">"J"</span><span class="op">)</span>  <span class="co"># evaluate y starts with J</span></code></pre></div>
<pre><code><span class="co">## [1] FALSE</span></code></pre>
<p>With functions that return logical values we can reverse the logical value by prefixing the function with <code>!</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">!</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_starts.html" class="external-link">str_starts</a></span><span class="op">(</span><span class="va">y</span>, <span class="st">"J"</span><span class="op">)</span>  <span class="co"># evaluate y starts with J, reversed</span></code></pre></div>
<pre><code><span class="co">## [1] TRUE</span></code></pre>
<p>So with this in mind we can control the code flow with the <code>if()</code> function. The most basic function to control code to execute or not, is to use the <code>if()</code> function. This function evaluates whether an operation returns <code>TRUE</code> or <code>FALSE</code> –if <code>TRUE</code> then the code executes, if not then it does not.</p>
<p>Let’s make a simple piece of code that returns a message if the character vector starts with “D”.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_starts.html" class="external-link">str_starts</a></span><span class="op">(</span><span class="va">y</span>, <span class="st">"D"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># if evaluate y starts with J is TRUE</span>
    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"This name starts with 'D'"</span><span class="op">)</span>  <span class="co"># if true, print message</span>
<span class="op">}</span></code></pre></div>
<pre><code><span class="co">## [1] "This name starts with 'D'"</span></code></pre>
<p>Inside the <code>if()</code> function itself we add the logical operation. Then we add opening and closing braces to tell the code what to execute if the logical operation returns <code>TRUE</code>.</p>
<p>In this case the code only runs if the vector element starts with “D”. But sometimes we want to execute some code if the <code>if()</code> operation returns <code>FALSE</code>. This is where the <code>else</code> condition comes in. Let’s change the value of <code>y</code> to “Judieth”.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">y</span> <span class="op">&lt;-</span> <span class="st">"Judeith"</span>  <span class="co"># set y to Judeith</span>
<span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_starts.html" class="external-link">str_starts</a></span><span class="op">(</span><span class="va">y</span>, <span class="st">"D"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># if evaluate y starts with D is TRUE</span>
    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"This name starts with 'D'"</span><span class="op">)</span>  <span class="co"># if true, message</span>
<span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"This name does not start with 'D'"</span><span class="op">)</span>  <span class="co"># if false, print message</span>
<span class="op">}</span></code></pre></div>
<pre><code><span class="co">## [1] "This name does not start with 'D'"</span></code></pre>
<p>Note that the <code>else</code> condition opens and closes a new set of braces which wrap the alternative condition. This effectively makes our code more dynamic adjusting to the particular values of a given object.</p>
</div>
<div class="section level3">
<h3 id="custom-functions">Custom functions<a class="anchor" aria-label="anchor" href="#custom-functions"></a>
</h3>
<p>Now if we would like to use the code above again in our code we could copy and paste it again where we need it. We may even adjust it so that we change the logical evaluation expression for a similar, but distinct situation. But ideally we would be able to reuse the code in a way that provides us similar functionality but with some flexibility. This is where writing a custom function comes in handy.</p>
<p>A custom function is simply a way to reuse code and make that code easily accessible. In it’s most basic form creating a custom function includes calling the <code>function()</code> function and assigning it to an object name. The code to be run by the function is wrapped in braces.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># some code to run</span>
<span class="op">}</span></code></pre></div>
<p>If the code we want to run inside our function depends on some variable or variables, we include them inside the <code>function()</code> function. The names of these variables are included in the code and the values they are assigned are passed on to the code. These variables are known as arguments.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">argument</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">argument</span><span class="op">)</span>  <span class="co"># print message</span>
<span class="op">}</span></code></pre></div>
<p>Now I can assign the value of <code>argument</code> in the <code>my_function()</code> function to anything I want and it will be reflected in the code that is run.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">my_function</span><span class="op">(</span>argument <span class="op">=</span> <span class="st">"Hi"</span><span class="op">)</span>  <span class="co"># print `argument`</span></code></pre></div>
<pre><code><span class="co">## [1] "Hi"</span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">my_function</span><span class="op">(</span>argument <span class="op">=</span> <span class="st">"Hi Jerid"</span><span class="op">)</span>  <span class="co"># print `argument`</span></code></pre></div>
<pre><code><span class="co">## [1] "Hi Jerid"</span></code></pre>
<p>A function can have no arguments or multiple arguments, as needed. Furthermore, the function’s arguments can have default values. Let’s rewrite the <code>my_function()</code> function to include two arguments, one of which will have a default value. I’m also going to make the argument names a bit more meaningful so that their use is more transparent and rename the function so that it too is more meaningful.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">greetings</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">greeting</span> <span class="op">=</span> <span class="st">"Hi"</span>, <span class="va">name</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># Function: Print a greeting and name</span>
    <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">greeting</span>, <span class="va">name</span><span class="op">)</span>  <span class="co"># print message</span>
<span class="op">}</span>

<span class="fu">greetings</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Jerid"</span><span class="op">)</span>  <span class="co"># print greeting to name</span></code></pre></div>
<pre><code><span class="co">## [1] "Hi Jerid"</span></code></pre>
<p>An argument with a default value is specified in the function creation itself. Since it has a default value it does not need to be specified in the use of that function. If, however, we want some other value other than the default, we need to assign the argument the new value.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">greetings</span><span class="op">(</span>greeting <span class="op">=</span> <span class="st">"Hello"</span>, name <span class="op">=</span> <span class="st">"Jerid"</span><span class="op">)</span>  <span class="co"># print greeting to name</span></code></pre></div>
<pre><code><span class="co">## [1] "Hello Jerid"</span></code></pre>
<p>Let’s apply this knowledge of custom functions to the code from the <code>if/else</code> example in the previous section. Since this will be a function we will want to be used in similar situation, but still have some flexibility we look to what we would like to maintain in the code and what aspects we would like to have depend on values we pass to the function. I think it makes sense to have the <code>name</code> and the <code>letter</code> be arguments. I’ll set the <code>letter</code> argument to default to “D”.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">name_starts_with</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">name</span>, <span class="va">letter</span> <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># Function: Evaluates if the name starts with the given letter</span>

    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_starts.html" class="external-link">str_starts</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">letter</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="co"># if evaluate name starts with letter</span>
        <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">"starts with"</span>, <span class="va">letter</span><span class="op">)</span>  <span class="co"># if true, print message</span>
    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">"does not start with"</span>, <span class="va">letter</span><span class="op">)</span>  <span class="co"># if false, print message</span>
    <span class="op">}</span>
<span class="op">}</span>

<span class="fu">name_starts_with</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Jerid"</span><span class="op">)</span>  <span class="co"># name starts with D message</span></code></pre></div>
<pre><code><span class="co">## [1] "Jerid does not start with D"</span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">name_starts_with</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Jerid"</span>, letter <span class="op">=</span> <span class="st">"J"</span><span class="op">)</span>  <span class="co"># name starts with J message</span></code></pre></div>
<pre><code><span class="co">## [1] "Jerid starts with J"</span></code></pre>
<div class="tip">
<p>Note that I’ve added the argument <code>name</code> to the message in the <code><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste()</a></code> function.</p>
</div>
<p>There are two more points to consider when creating and using custom functions in your code projects. First, if you plan to use this function in distinct parts of your project, that is in distinct R scripts or R Markdown documents, you will want to add this function to a separate R script and then source the script inside of your code to make the function accessible.</p>
<p>Let me unpack this a bit. If you notice when you create the custom function, you must run the custom function itself to make it accessible in your code. It will then appear in your ‘Environment’ pane in RStudio under the subsection ‘Functions’. The objects (and functions) in the ‘Environment’ pane are session-specific, that is if you restart R, the ‘Environment’ is cleared. To be able to access this function anywhere you want, create an new R script (.R) and copy the function into this script. I will often create a directory specifically for files with functions.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="ex">functions/</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="ex">└──</span> functions.R</span></code></pre></div>
<p>Then we use the <code><a href="https://rdrr.io/r/base/source.html" class="external-link">source()</a></code> function to run this <code>function.R</code> script, which only contains functions, effectively adding the functions stored there to our current R session. Note that the relative path to the <code>functions.R</code> file is the only argument to <code><a href="https://rdrr.io/r/base/source.html" class="external-link">source()</a></code>.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"../functions/functions.R"</span><span class="op">)</span></code></pre></div>
<div class="tip">
<p>It is a point of personal preference whether you create individual R scripts for each custom function you create, or if you group multiple functions into one R script.</p>
</div>
<p>Second, if we invoke a function from a package, say the stringr package in this case, it is important that that package is either loaded before the function is run or that the reference to the function is made explicit (with the <code>::</code> convention). If you use various functions from a package, it is worthwhile to load the package with <code><a href="https://rdrr.io/r/base/library.html" class="external-link">library()</a></code> at the beginning of your custom function.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">name_starts_with</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">name</span>, <span class="va">letter</span> <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># Function: Evaluates if the name starts with the given letter</span>

    <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://stringr.tidyverse.org" class="external-link">stringr</a></span><span class="op">)</span>  <span class="co"># to detect first letter</span>

    <span class="kw">if</span> <span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_starts.html" class="external-link">str_starts</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">letter</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="co"># if evaluate name starts with letter</span>
        <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">"starts with"</span>, <span class="va">letter</span><span class="op">)</span>  <span class="co"># if true, print message</span>
    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">"does not start with"</span>, <span class="va">letter</span><span class="op">)</span>  <span class="co"># if false, print message</span>
    <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p>Alternatively, you can use the <code>::</code> convention to avoid loading the entire package.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">name_starts_with</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">name</span>, <span class="va">letter</span> <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># Function: Evaluates if the name starts with the given letter</span>

    <span class="kw">if</span> <span class="op">(</span><span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_starts.html" class="external-link">str_starts</a></span><span class="op">(</span><span class="va">name</span>, <span class="va">letter</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
        <span class="co"># if evaluate name starts with letter</span>
        <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">"starts with"</span>, <span class="va">letter</span><span class="op">)</span>  <span class="co"># if true, print message</span>
    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
        <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">name</span>, <span class="st">"does not start with"</span>, <span class="va">letter</span><span class="op">)</span>  <span class="co"># if false, print message</span>
    <span class="op">}</span>
<span class="op">}</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="iteration">Iteration<a class="anchor" aria-label="anchor" href="#iteration"></a>
</h3>
<p>So at this point we’ve seen how to control the flow of our code with control statements and explored how to reuse code in an efficient way by creating and using custom functions. The final coding strategy in the recipe concerns passing multiple arguments to the same function and having the function deal with each argument in turn and return the results from each together. This is known as iteration.</p>
<p>Say we want to use our <code>name_starts_with()</code> function and pass multiple names to this function. One way to do this is to simply apply the function multiple times with a new name.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">name_starts_with</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Dawn"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "Dawn starts with D"</span></code></pre>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">name_starts_with</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Vince"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "Vince does not start with D"</span></code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">name_starts_with</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Stephanie"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [1] "Stephanie does not start with D"</span></code></pre>
<p>This, however, is not ideal. If we are working with many values the code will become cumbersome. To be able to apply our custom function to many values at the same time, we turn to the <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map()</a></code> function from the purrr package.</p>
<p>First let’s some names to work with. The <code>babynames</code> dataset from the babynames package will help us out here. I’ll do a random sample of 10 names from this dataset and only keep the <code>name</code> column.</p>
<div class="tip">
<p>Use `?babynames::babynames to find out more about this dataset.</p>
</div>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/hadley/babynames" class="external-link">babynames</a></span><span class="op">)</span> <span class="co"># for the babynames dataset</span>

<span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1111</span><span class="op">)</span> <span class="co"># make the random sample reproducible</span>

<span class="va">sample_names</span> <span class="op">&lt;-</span> 
  <span class="va">babynames</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># dataset</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_sample</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  <span class="co"># randomly sample 10 names</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html" class="external-link">pull</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span> <span class="co"># isolate the `name` vector</span>

<span class="va">sample_names</span></code></pre></div>
<pre><code><span class="co">##  [1] "Macey"   "Tausha"  "Merlin"  "Vernel"  "Dontez"  "Nallely" "Anna"   </span>
<span class="co">##  [8] "Hogan"   "Manola"  "Jakalyn"</span></code></pre>
<p>Let’s start by seeing what happens if we pass the names in the <code>sample_names</code> vector to our function <code>name_starts_with()</code>.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sample_names</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu">name_starts_with</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning in if (str_starts(name, letter)) {: the condition has length &gt; 1 and</span>
<span class="co">## only the first element will be used</span></code></pre>
<pre><code><span class="co">##  [1] "Macey does not start with D"   "Tausha does not start with D" </span>
<span class="co">##  [3] "Merlin does not start with D"  "Vernel does not start with D" </span>
<span class="co">##  [5] "Dontez does not start with D"  "Nallely does not start with D"</span>
<span class="co">##  [7] "Anna does not start with D"    "Hogan does not start with D"  </span>
<span class="co">##  [9] "Manola does not start with D"  "Jakalyn does not start with D"</span></code></pre>
<p>We see there is a warning triggered but at first glance it still seems that our function worked. Take a closer look, however, and we see that the name “Dontez” gets the message “does not start with D” –which is clearly not the case. What has happened is that our if-else statements does not allow for multiple values to be passed to it and it just accepts the first value, in this case ‘Macey’ –which does not start with ‘D’. We can see this clearly by changing the letter to evaluate to ‘M’, as ‘Macey’ was the first value.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sample_names</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu">name_starts_with</span><span class="op">(</span>letter <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Warning in if (str_starts(name, letter)) {: the condition has length &gt; 1 and</span>
<span class="co">## only the first element will be used</span></code></pre>
<pre><code><span class="co">##  [1] "Macey starts with M"   "Tausha starts with M"  "Merlin starts with M" </span>
<span class="co">##  [4] "Vernel starts with M"  "Dontez starts with M"  "Nallely starts with M"</span>
<span class="co">##  [7] "Anna starts with M"    "Hogan starts with M"   "Manola starts with M" </span>
<span class="co">## [10] "Jakalyn starts with M"</span></code></pre>
<p>Same warning and now all of the messages claim that the names start with ‘M’.</p>
<p>The <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map()</a></code> function allows us to pass multiple values to the same function and each value is run on the function and then the results are returned together.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sample_names</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">name_starts_with</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## [[1]]</span>
<span class="co">## [1] "Macey does not start with D"</span>
<span class="co">## </span>
<span class="co">## [[2]]</span>
<span class="co">## [1] "Tausha does not start with D"</span>
<span class="co">## </span>
<span class="co">## [[3]]</span>
<span class="co">## [1] "Merlin does not start with D"</span>
<span class="co">## </span>
<span class="co">## [[4]]</span>
<span class="co">## [1] "Vernel does not start with D"</span>
<span class="co">## </span>
<span class="co">## [[5]]</span>
<span class="co">## [1] "Dontez starts with D"</span>
<span class="co">## </span>
<span class="co">## [[6]]</span>
<span class="co">## [1] "Nallely does not start with D"</span>
<span class="co">## </span>
<span class="co">## [[7]]</span>
<span class="co">## [1] "Anna does not start with D"</span>
<span class="co">## </span>
<span class="co">## [[8]]</span>
<span class="co">## [1] "Hogan does not start with D"</span>
<span class="co">## </span>
<span class="co">## [[9]]</span>
<span class="co">## [1] "Manola does not start with D"</span>
<span class="co">## </span>
<span class="co">## [[10]]</span>
<span class="co">## [1] "Jakalyn does not start with D"</span></code></pre>
<p>Now we get the correct output, but the results of <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map()</a></code> by default return a list. We would like the results to be a character vector, just like the character vector that we passed to the function. There are various <code>map_*()</code> functions that specifiy what the type of object that should be returned is. In this case we want <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_chr()</a></code> to give us a single character vector.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sample_names</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_chr</a></span><span class="op">(</span><span class="va">name_starts_with</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##  [1] "Macey does not start with D"   "Tausha does not start with D" </span>
<span class="co">##  [3] "Merlin does not start with D"  "Vernel does not start with D" </span>
<span class="co">##  [5] "Dontez starts with D"          "Nallely does not start with D"</span>
<span class="co">##  [7] "Anna does not start with D"    "Hogan does not start with D"  </span>
<span class="co">##  [9] "Manola does not start with D"  "Jakalyn does not start with D"</span></code></pre>
<p>Our <code>name_starts_with()</code> function has another possible argument, the <code>letter</code> argument. To specify a new value for that argument, we can add it to the <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map()</a></code> call. Note, however, that each argument-value pair will need to be separated by a comma.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sample_names</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_chr</a></span><span class="op">(</span><span class="va">name_starts_with</span>, letter <span class="op">=</span> <span class="st">"M"</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">##  [1] "Macey starts with M"           "Tausha does not start with M" </span>
<span class="co">##  [3] "Merlin starts with M"          "Vernel does not start with M" </span>
<span class="co">##  [5] "Dontez does not start with M"  "Nallely does not start with M"</span>
<span class="co">##  [7] "Anna does not start with M"    "Hogan does not start with M"  </span>
<span class="co">##  [9] "Manola starts with M"          "Jakalyn does not start with M"</span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="cases">Cases<a class="anchor" aria-label="anchor" href="#cases"></a>
</h2>
<p>The examples of control statements, custom functions, and iteration above were hopefully helpful to illustrate their use, but they are admittedly basic. To ground these coding strategies for acquiring text data, let’s turn to working with more realistic cases.</p>
<div class="section level3">
<h3 id="acquire-tweets">Acquire tweets<a class="anchor" aria-label="anchor" href="#acquire-tweets"></a>
</h3>
<p>The rtweet package has a wide range of functions which allow for access to the Twitter API. A very useful function is the <code><a href="https://rdrr.io/pkg/rtweet/man/search_tweets.html" class="external-link">search_tweets()</a></code> function which allows access to a sample of Twitter posts within the recent past based on a search query.</p>
<div class="tip">
<p>For more options use <code><a href="https://rdrr.io/pkg/rtweet/man/search_tweets.html" class="external-link">?rtweet::search_tweets</a></code> to explore the documentation.</p>
</div>
<p>In this test case we are going to aim to collect tweets for various search query terms one at a time and then compile the results into one data frame.</p>
<p>First let’s set up our basic function to meet our aims to get started. Here I’ve used the query term ‘uppity’, and set the function to retrieve approximately 100 tweets matching the term and the type of tweet is set to recent. I’ve chosen to avoid retweets and set the geographic boundary to be The United States. I’ve also set the Twitter API token that I’m using to authenticate this search.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">tweets</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/rtweet/man/search_tweets.html" class="external-link">search_tweets</a></span><span class="op">(</span>q <span class="op">=</span> <span class="st">"uppity"</span>, <span class="co"># query term</span>
                n <span class="op">=</span> <span class="fl">100</span>, <span class="co"># number of desired tweets</span>
                include_rts <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># no retweets</span>
                geocode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rtweet/man/lookup_coords.html" class="external-link">lookup_coords</a></span><span class="op">(</span><span class="st">"usa"</span><span class="op">)</span>, <span class="co"># only from US</span>
                token <span class="op">=</span> <span class="va">student_token</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  <span class="co"># token for authentication</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtweet/man/lat_lng.html" class="external-link">lat_lng</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># extract the geocoordinates where available</span></code></pre></div>
<p>This query returns the following set of information.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="va">tweets</span><span class="op">)</span></code></pre></div>
<pre><code><span class="co">## Rows: 100</span>
<span class="co">## Columns: 92</span>
<span class="co">## $ user_id                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "1007992881531969536", "1470190191877013514", …</span>
<span class="co">## $ status_id               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "1516101406716936195", "1516099241298604040", …</span>
<span class="co">## $ created_at              <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span> 2022-04-18 17:08:37, 2022-04-18 17:00:01, 202…</span>
<span class="co">## $ screen_name             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "KennadyTim", "PaneraBabe", "ambientsidewalk",…</span>
<span class="co">## $ text                    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "@Jim_Jordan Because free speech = truth to po…</span>
<span class="co">## $ source                  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Twitter Web App", "Twitter for iPhone", "Twit…</span>
<span class="co">## $ display_text_width      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 189, 69, 263, 14, 59, 23, 258, 142, 141, 270, …</span>
<span class="co">## $ reply_to_status_id      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "1516077280929406976", NA, "151607434975269274…</span>
<span class="co">## $ reply_to_user_id        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "18166778", NA, "549322049", "1269855100115152…</span>
<span class="co">## $ reply_to_screen_name    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Jim_Jordan", NA, "dropoutninja", "KingkaayCo3…</span>
<span class="co">## $ is_quote                <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS…</span>
<span class="co">## $ is_retweet              <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS…</span>
<span class="co">## $ favorite_count          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 0, 1, 1, 0, 1, 1, 0, 4, 0, 11, 1, 0, 1, 2, …</span>
<span class="co">## $ retweet_count           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…</span>
<span class="co">## $ quote_count             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">## $ reply_count             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">## $ hashtags                <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</span>
<span class="co">## $ symbols                 <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</span>
<span class="co">## $ urls_url                <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "open…</span>
<span class="co">## $ urls_t.co               <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "http…</span>
<span class="co">## $ urls_expanded_url       <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "http…</span>
<span class="co">## $ media_url               <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</span>
<span class="co">## $ media_t.co              <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</span>
<span class="co">## $ media_expanded_url      <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</span>
<span class="co">## $ media_type              <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</span>
<span class="co">## $ ext_media_url           <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</span>
<span class="co">## $ ext_media_t.co          <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</span>
<span class="co">## $ ext_media_expanded_url  <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</span>
<span class="co">## $ ext_media_type          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">## $ mentions_user_id        <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> "18166778", NA, "549322049", "126985510011515…</span>
<span class="co">## $ mentions_screen_name    <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> "Jim_Jordan", NA, "dropoutninja", "KingkaayCo…</span>
<span class="co">## $ lang                    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "en", "en", "en", "en", "en", "en", "en", "en"…</span>
<span class="co">## $ quoted_status_id        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "1…</span>
<span class="co">## $ quoted_text             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "A…</span>
<span class="co">## $ quoted_created_at       <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 2…</span>
<span class="co">## $ quoted_source           <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "T…</span>
<span class="co">## $ quoted_favorite_count   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 13…</span>
<span class="co">## $ quoted_retweet_count    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 19…</span>
<span class="co">## $ quoted_user_id          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "1…</span>
<span class="co">## $ quoted_screen_name      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "w…</span>
<span class="co">## $ quoted_name             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "S…</span>
<span class="co">## $ quoted_followers_count  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 28…</span>
<span class="co">## $ quoted_friends_count    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 19…</span>
<span class="co">## $ quoted_statuses_count   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, 37…</span>
<span class="co">## $ quoted_location         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "H…</span>
<span class="co">## $ quoted_description      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, "I…</span>
<span class="co">## $ quoted_verified         <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, FA…</span>
<span class="co">## $ retweet_status_id       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">## $ retweet_text            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">## $ retweet_created_at      <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…</span>
<span class="co">## $ retweet_source          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">## $ retweet_favorite_count  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">## $ retweet_retweet_count   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">## $ retweet_user_id         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">## $ retweet_screen_name     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">## $ retweet_name            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">## $ retweet_followers_count <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">## $ retweet_friends_count   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">## $ retweet_statuses_count  <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">## $ retweet_location        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">## $ retweet_description     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">## $ retweet_verified        <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">## $ place_url               <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, "https://api.twitter.com/1.1/geo/id/018d3e…</span>
<span class="co">## $ place_name              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, "North Tonawanda", NA, "Los Angeles", NA, …</span>
<span class="co">## $ place_full_name         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, "North Tonawanda, NY", NA, "Los Angeles, C…</span>
<span class="co">## $ place_type              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, "city", NA, "city", NA, NA, NA, NA, NA, NA…</span>
<span class="co">## $ country                 <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, "United States", NA, "United States", NA, …</span>
<span class="co">## $ country_code            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, "US", NA, "US", NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">## $ geo_coords              <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;NA, NA&gt;, &lt;NA, NA&gt;, &lt;NA, NA&gt;, &lt;NA, NA&gt;, &lt;NA, …</span>
<span class="co">## $ coords_coords           <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;NA, NA&gt;, &lt;NA, NA&gt;, &lt;NA, NA&gt;, &lt;NA, NA&gt;, &lt;NA, …</span>
<span class="co">## $ bbox_coords             <span style="color: #949494; font-style: italic;">&lt;list&gt;</span> &lt;NA, NA, NA, NA, NA, NA, NA, NA&gt;, &lt;-78.9, -78…</span>
<span class="co">## $ status_url              <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "https://twitter.com/KennadyTim/status/1516101…</span>
<span class="co">## $ name                    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Tim Kennady", "Managemento.", "Heath #BlackLi…</span>
<span class="co">## $ location                <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "California, USA", "Sesame street", "Austin, T…</span>
<span class="co">## $ description             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "Polished Concrete Industry Visionary and Prov…</span>
<span class="co">## $ url                     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, "https://t.co/mGinIugD1m", NA, NA,…</span>
<span class="co">## $ protected               <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS…</span>
<span class="co">## $ followers_count         <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 5, 38, 829, 1486, 2754, 233, 395, 23053, 14, 9…</span>
<span class="co">## $ friends_count           <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 17, 21, 280, 1148, 3177, 281, 1081, 15088, 57,…</span>
<span class="co">## $ listed_count            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 0, 0, 14, 7, 77, 1, 11, 52, 0, 10, 56, 0, 22, …</span>
<span class="co">## $ statuses_count          <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 115, 1476, 6884, 20443, 117764, 5012, 13843, 9…</span>
<span class="co">## $ favourites_count        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 13, 443, 8044, 120175, 91678, 6773, 27235, 285…</span>
<span class="co">## $ account_created_at      <span style="color: #949494; font-style: italic;">&lt;dttm&gt;</span> 2018-06-16 14:26:45, 2021-12-13 00:34:00, 200…</span>
<span class="co">## $ verified                <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALS…</span>
<span class="co">## $ profile_url             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, "https://t.co/mGinIugD1m", NA, NA,…</span>
<span class="co">## $ profile_expanded_url    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, NA, "https://linktr.ee/CaymenParks", N…</span>
<span class="co">## $ account_lang            <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">## $ profile_banner_url      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "https://pbs.twimg.com/profile_banners/1007992…</span>
<span class="co">## $ profile_background_url  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> NA, NA, "http://abs.twimg.com/images/themes/th…</span>
<span class="co">## $ profile_image_url       <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> "http://pbs.twimg.com/profile_images/100799466…</span>
<span class="co">## $ lat                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> NA, 43.1, NA, 34.0, NA, NA, NA, NA, NA, NA, NA…</span>
<span class="co">## $ lng                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> NA, -78.9, NA, -118.4, NA, NA, NA, NA, NA, NA,…</span></code></pre>
<p>OK. Since we are going to want to pass various terms/ expressions to this function we will also want to make sure that the search query is added to the structure of the data frame. We do this by creating a variable to pass to the <code>q</code> argument and then add a column to the data frame with <code><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate()</a></code>.</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">search_term</span> <span class="op">&lt;-</span> <span class="st">"uppity"</span> <span class="co"># create a search_term variable</span>

<span class="va">tweets</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/rtweet/man/search_tweets.html" class="external-link">search_tweets</a></span><span class="op">(</span>q <span class="op">=</span> <span class="va">search_term</span>, <span class="co"># query term (from search_term)</span>
                n <span class="op">=</span> <span class="fl">100</span>, <span class="co"># number of desired tweets</span>
                include_rts <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># no retweets</span>
                geocode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rtweet/man/lookup_coords.html" class="external-link">lookup_coords</a></span><span class="op">(</span><span class="st">"usa"</span><span class="op">)</span>, <span class="co"># only from US</span>
                token <span class="op">=</span> <span class="va">student_token</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  <span class="co"># token for authentication</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtweet/man/lat_lng.html" class="external-link">lat_lng</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># extract the geocoordinates where available</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>search_term <span class="op">=</span> <span class="va">search_term</span><span class="op">)</span> <span class="co"># add search_term value to the data frame</span></code></pre></div>
<p>Now we can replace the value of <code>search_term</code> and run the search again, if we wanted, and the search term would be added to the new column <code>search_term</code> in the resulting data frame. But let’s go one step further and create a custom function which makes it easy for us to run the search replacing the <code>search_term</code>. In addition, I will add a variable placeholder for <code>n</code> in the custom function which we can change as needed.</p>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">term_search</span> <span class="op">&lt;-</span> 
  <span class="kw">function</span><span class="op">(</span><span class="va">search_term</span>, <span class="va">n</span> <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op">{</span>
    <span class="co"># Function: </span>
    <span class="co"># Search recent tweets for specific term</span>
    
    <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://CRAN.R-project.org/package=rtweet" class="external-link">rtweet</a></span><span class="op">)</span> <span class="co"># to search Twitter API</span>
    
    <span class="va">tweets</span> <span class="op">&lt;-</span> 
      <span class="fu"><a href="https://rdrr.io/pkg/rtweet/man/search_tweets.html" class="external-link">search_tweets</a></span><span class="op">(</span>q <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sQuote.html" class="external-link">sQuote</a></span><span class="op">(</span><span class="va">search_term</span><span class="op">)</span>, <span class="co"># query term (from search_term)</span>
                    n <span class="op">=</span> <span class="va">n</span>, <span class="co"># number of desired tweets (from n)</span>
                    include_rts <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># no retweets</span>
                    geocode <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rtweet/man/lookup_coords.html" class="external-link">lookup_coords</a></span><span class="op">(</span><span class="st">"usa"</span><span class="op">)</span>, <span class="co"># only from US</span>
                    token <span class="op">=</span> <span class="va">student_token</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>  <span class="co"># token for authentication</span>
      <span class="fu"><a href="https://rdrr.io/pkg/rtweet/man/lat_lng.html" class="external-link">lat_lng</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># extract the geocoordinates where available</span>
      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>search_term <span class="op">=</span> <span class="va">search_term</span><span class="op">)</span> <span class="co"># add search_term value to the data frame</span>
    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">tweets</span><span class="op">)</span> <span class="co"># return the results</span>
  <span class="op">}</span></code></pre></div>
<div class="tip">
<p>Note that I’ve added <code><a href="https://rdrr.io/r/base/sQuote.html" class="external-link">sQuote()</a></code> around the <code>search_term</code> in the <code>search_tweet</code> function to make sure that multiword terms are quoted with single quotes <code>'term expression'</code>. This tells the function to search for the whole phrase not just individual words.</p>
</div>
<p>As is the <code>term_search()</code> function is pretty useful and makes searching along the parameters we have set easy to do. But we want to search multiple terms/ expressions at the same time and return them together.</p>
<p>Here are the search terms I’ve selected in a vector called <code>bias_terms</code>.</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Biased language Source:</span>
<span class="co"># https://blog.ongig.com/diversity-and-inclusion/biased-language-examples/</span>

<span class="va">bias_terms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"uppity"</span>, <span class="st">"ghetto"</span>, <span class="st">"peanut gallery"</span>, <span class="st">"call a spade a spade"</span><span class="op">)</span></code></pre></div>
<p>Now we can employ the <code><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map()</a></code> function from the purrr package to pass each term to our custom function <code>term_search</code>. I’ve set <code>n</code> to 500, overriding the default of 100.</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results</span> <span class="op">&lt;-</span> 
  <span class="va">bias_terms</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># terms to search</span>
  <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">term_search</span>, n <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># apply the function to each term, retrieve 500 tweets (if available)</span>
  <span class="fu"><a href="https://rdrr.io/pkg/rtweet/man/do_call_rbind.html" class="external-link">do_call_rbind</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># join the results by rows</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># return the results</span></code></pre></div>
<p>Let’s take a look at how many tweets we obtained for each of the search terms.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">search_term</span>, sort <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="kable-table">
<table class="table">
<thead><tr class="header">
<th align="left">search_term</th>
<th align="right">n</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">call a spade a spade</td>
<td align="right">500</td>
</tr>
<tr class="even">
<td align="left">ghetto</td>
<td align="right">500</td>
</tr>
<tr class="odd">
<td align="left">uppity</td>
<td align="right">499</td>
</tr>
<tr class="even">
<td align="left">peanut gallery</td>
<td align="right">273</td>
</tr>
</tbody>
</table>
</div>
<p>Notice we obtained 500 matching tweets for all the terms except ‘peanut gallery’. This underscores that we are not guaranteed to get exactly the number of tweets requested at any given time.</p>
<p>Let’s save these results to disk using the <code><a href="https://rdrr.io/pkg/rtweet/man/write_as_csv.html" class="external-link">save_as_csv()</a></code> function from rtweet.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/rtweet/man/write_as_csv.html" class="external-link">save_as_csv</a></span><span class="op">(</span><span class="va">results</span>, file_name <span class="op">=</span> <span class="st">"../data/original/twitter/bias_terms.csv"</span><span class="op">)</span></code></pre></div>
<p>In a reproducible research project we may want to make sure that we don’t overwrite the results of our Twitter query each time we run this script as the result will be distinct. We can use a control statement to avoid conducting a new search, unless it is desired to do so.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">conduct_search</span> <span class="op">&lt;-</span> <span class="cn">FALSE</span> <span class="co"># set to TRUE to conduct a new search</span>

<span class="kw">if</span><span class="op">(</span><span class="va">conduct_search</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Conducting new search. \n"</span><span class="op">)</span>
  
  <span class="va">bias_terms</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"uppity"</span>, <span class="st">"ghetto"</span>, <span class="st">"peanut gallery"</span>, <span class="st">"call a spade a spade"</span><span class="op">)</span>
  
  <span class="va">bias_terms</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># terms to search</span>
    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">term_search</span>, n <span class="op">=</span> <span class="fl">500</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># apply the function to each term, retrieve 500 tweets (if available)</span>
    <span class="fu"><a href="https://rdrr.io/pkg/rtweet/man/do_call_rbind.html" class="external-link">do_call_rbind</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co"># join the results by rows</span>
    <span class="fu"><a href="https://rdrr.io/pkg/rtweet/man/write_as_csv.html" class="external-link">save_as_csv</a></span><span class="op">(</span>file_name <span class="op">=</span> <span class="st">"../data/original/twitter/bias_terms.csv"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Search results saved to disk. \n"</span><span class="op">)</span>
  
<span class="op">}</span> <span class="kw">else</span> <span class="op">{</span>
  <span class="fu"><a href="https://rdrr.io/r/base/cat.html" class="external-link">cat</a></span><span class="op">(</span><span class="st">"Keeping previous search results. \n"</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Just for fun, let’s map these tweets and color the points on the map according to the specific bias term. We get the geocoordinates from the <code>lat</code> and <code>lng</code> variables extracted by the <code><a href="https://rdrr.io/pkg/rtweet/man/lat_lng.html" class="external-link">lat_lng()</a></code> function.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">states_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html" class="external-link">map_data</a></span><span class="op">(</span><span class="st">"state"</span><span class="op">)</span>  <span class="co"># from ggplot2</span>

<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">states_map</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>,
    fill <span class="op">=</span> <span class="st">"grey"</span>, color <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Tweets in the USA"</span>, subtitle <span class="op">=</span> <span class="st">"Bias terms"</span><span class="op">)</span>

<span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">results</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">lng</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="va">search_term</span><span class="op">)</span>,
    alpha <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span>, size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></code></pre></div>
<p><img src="recipe_6_files/figure-html/usa-map-test-1.png" width="85%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="webscrape-text">Webscrape text<a class="anchor" aria-label="anchor" href="#webscrape-text"></a>
</h3>
<p><strong>Under development</strong></p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">search_url</span> <span class="op">&lt;-</span> <span class="st">"https://www.msnbc.com/search/?q=latinx#gsc.tab=0&amp;gsc.q=latinx%20opinion&amp;gsc.sort=date"</span>

<span class="va">search_url</span> <span class="op">&lt;-</span> <span class="st">"https://www.msnbc.com/opinion/biden-reversing-trump-s-discriminatory-housing-rulings-we-need-more-n1276857"</span>

<span class="va">search_html</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html" class="external-link">read_html</a></span><span class="op">(</span><span class="va">search_url</span><span class="op">)</span>

<span class="va">search_html</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rvest.tidyverse.org/reference/html_element.html" class="external-link">html_elements</a></span><span class="op">(</span><span class="st">"div.article-body__content"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rvest.tidyverse.org/reference/html_text.html" class="external-link">html_text</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"http://www.chakoteya.net/DoctorWho/episodes13.html"</span>

<span class="va">html</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html" class="external-link">read_html</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span>

<span class="va">html</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rvest.tidyverse.org/reference/html_element.html" class="external-link">html_elements</a></span><span class="op">(</span><span class="st">"a"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rvest.tidyverse.org/reference/html_attr.html" class="external-link">html_attr</a></span><span class="op">(</span><span class="st">"href"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="co"># pluck() %&gt;%</span>
<span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"^\\d.*.html$"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">main_url</span> <span class="op">&lt;-</span> <span class="st">"http://www.chakoteya.net/DoctorWho/"</span>

<span class="va">html</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html" class="external-link">read_html</a></span><span class="op">(</span><span class="va">main_url</span><span class="op">)</span>

<span class="va">html</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rvest.tidyverse.org/reference/html_element.html" class="external-link">html_elements</a></span><span class="op">(</span><span class="st">"a"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
    <span class="fu"><a href="https://rvest.tidyverse.org/reference/html_attr.html" class="external-link">html_attr</a></span><span class="op">(</span><span class="st">"href"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">url</span> <span class="op">&lt;-</span> <span class="st">"https://www.nytimes.com/2021/09/21/opinion/gender-pronouns-they.html"</span>
<span class="va">html</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html" class="external-link">read_html</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span>

<span class="va">html</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p>In this recipe we have taken a closer look at some key programming strategies that are applicable to acquiring data, but also for many other parts of a text analysis project. These strategies allow the programmer to control the code flow, create reusable custom functions and iterate programming tasks. Together these strategies will make your more concise, efficient, and effective.</p>
<p>In the next recipe we will turn to curating data. That is, the process of taking data or a dataset and manipulating it’s structure such that it conforms to tidy data principles.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jerid Francom.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>
2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
